<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DuckWriter</title>
	<link rel="manifest" href="manifest.json">

  <meta name="theme-color" content="#4A90E2">
  <link rel="icon" href="/icons/duck192.png" sizes="any">
  <link rel="apple-touch-icon" href="/icons/duck192.png">
	
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tiny.cloud/1/jan4l3rg06u6jg4gzqgvcqxytuissp09o7wfxde4axienbj7/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- 1. Global Styles & Theme Variables --- */
        :root {
            --bg-primary: #1e1e1e;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3c3c3c;
            --text-primary: #d4d4d4;
            --text-secondary: #a0a0a0;
            --accent-primary: #2ca9bc;
            --accent-text: #ffffff;
            --border-radius: 4px;
        }

        html, body {
            height: 100%;
            margin: 0;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-family: 'Georgia', serif;
            overflow: hidden; /* Prevent double scrollbars */
        }

        /* Set a larger base font-size to scale the entire UI */
        body {
            font-size: 1.2em;
        }

        /* --- 2. Main Layout Containers --- */
  #app-container {
    display: flex;
    height: 100vh;
    box-sizing: border-box; /* Ensures the border is included in the height */
    border-top: 10px solid #2D2D2D; /* Creates the top bezel */
	    border-bottom: 10px solid #2D2D2D; /* Creates the top bezel */
	


}

        /* Left sidebar for chapter navigation */
        #sidebar {
            width: 280px;
            border-right: 1px solid var(--bg-tertiary);
            background-color: var(--bg-secondary);
            padding: 2px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        /* Main content area holding the editor and its toolbar */
        #main-content {
            flex: 0 0 52rem; /* Fixed width, does not grow or shrink */
            min-width: 0;
             padding: 12px 12px 12px 12px; /* Top, Right, Bottom, Left */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;

        }

        /* Right sidebar for tools and settings */
        #right-sidebar {
            flex: 1; /* Allows this sidebar to grow and fill remaining space */
            min-width: 320px;
            border-left: 1px solid var(--bg-tertiary);

            background-color: var(--bg-secondary);
            padding: 12px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 20px;
       
        }

        /* --- 3. Sidebar Elements (Chapters & Tools) --- */
		/* Style for the editable project title in the left sidebar */
		#chapters-title {
			text-align: right;
			 padding: 6px;
			margin: 0 10px 10px 0; /* Top, Right, Bottom, Left */
			font-weight: 500;
			color: var(--text-secondary);
			font-size: 1.5rem;
			outline: none;
			        border-bottom: 3px solid var(--bg-tertiary);
			user-select: none;
		}

		/* Style for the tool titles in the right sidebar */
		#right-sidebar h3 {
			margin: 0 0 10px 5px;   /* Top, Right, Bottom, Left */
			font-weight: 500;
			color: var(--text-secondary);
			font-size: 1.1rem;
		}
        
        #tab-list {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px; /* Space for scrollbar */
        }

        /* Individual chapter tab item */
        .tab {
            padding: 12px 16px;
            border-bottom: 2px solid var(--bg-tertiary);
		
            border-radius: var(--border-radius);
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            user-select: none;
            transition: background-color 0.2s ease-in-out;
        }

        .tab:hover {
            background-color: var(--bg-tertiary);
        }

        .tab.active {
            background-color: var(--bg-tertiary);
            color: var(--accent-text);
            font-weight: 500;
        }

        /* Chapter name text within a tab */
        .tab-name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            outline: none;
        }
        
        /* Style for when a chapter name is being edited */
        .tab-name[contenteditable="true"] {
            background-color: var(--bg-primary);
            padding: 2px 4px; 
            border-radius: var(--border-radius);
            cursor: text;
        }

        
        
        /* The 'x' close button on a tab */
        .tab-close {
            margin-right: 10px;
            padding: 2px 6px;
            border-radius: 50%;
            color: transparent; /* Hidden by default, appears on hover */
            transition: color 0.15s ease-in-out;
        }

        .tab:hover .tab-close {
            color: var(--text-primary);
        }

        .tab .tab-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Decorative SVG container in the right sidebar */
        #deco-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
        }
        
        #deco-svg {
            width: 80%;
            height: 80%;
            opacity: 0.1;
        }
        
        /* --- 4. Toolbars (Left, Main, Right) --- */
        #sidebar-toolbar {
            display: flex;
            gap: 6px;
        padding: 8px;
            margin-top: auto; /* Pushes toolbar to the bottom of the sidebar */
            border-top: 1px solid var(--bg-tertiary);
            align-items: center;
        }

        #sidebar-toolbar button {
            background-color: transparent;
            color: var(--text-secondary);
            border: 1px solid transparent;
            border-radius: var(--border-radius);
            padding: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease-in-out, background-color 0.2s ease-in-out;
        }

        #sidebar-toolbar button:hover {
            color: var(--accent-primary);
            background-color: var(--bg-tertiary);
        }

        #sidebar-toolbar button:disabled {
            opacity: 0.2;
            cursor: not-allowed;
            background-color: transparent;
            color: var(--text-secondary);
        }
        
        /* Special button for project export, pushed to the right */
        #duck-export-btn {
            background: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
            margin-left: auto;
        }

        /* Main editor toolbar */
        #custom-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding-bottom: 12px;
            margin-bottom: 0px;
            border-top: 0px solid var(--bg-tertiary);
            align-items: center;
            flex-shrink: 0;
        }

        /* Generic button styling for main toolbar and right sidebar tools */
        #custom-toolbar button,
        .tool-section button {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--border-radius);
            padding: 8px 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }

        #custom-toolbar button:hover,
        .tool-section button:hover {
            color: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        #custom-toolbar button.active-command,
        .tool-section button.active-command {
            color: var(--accent-text);
            background-color: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        #custom-toolbar button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .toolbar-separator {
            width: 1px;
            background-color: var(--bg-secondary);
            margin: 4px 6px;
            height: 24px;
        }
        
        /* Right sidebar tool containers and sections */
        #tools-container {
            display: flex;
            flex-direction: column;
            gap: 4px;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .tool-section {
            display: flex;
            align-items: center;
            gap: 6px;
            background-color: var(--bg-primary);
            padding: 6px;
            border-radius: var(--border-radius);
            flex-wrap: wrap;
        }

        /* Collapsible containers for tool groups */
        #file-controls-container,
        #color-picker-container,
        #settings-container,
        #export-container {
            display: none; /* Hidden by default */
        }

        /* Class to make tool containers visible */
        #file-controls-container.visible,
        #color-picker-container.visible,
        #settings-container.visible ,
        #export-container.visible {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

  /* Label next to a tool toggle button */
.tool-section > label {
    font-size: 1rem;
    margin-left: 8px;
    color: #2d2d2d; /* Default color */
    user-select: none;
    flex-grow: 1;
    transition: color 0.2s ease-in-out;
}

/* Change color when hovering the button OR the label */
.tool-section > button:hover + label,
.tool-section > label:hover {
    color: #2CA9BC; /* Hover color (same as --accent-primary) */
}
        
        /* Hide label when the corresponding tool container is open */
        .tool-section > button.active-command + label {
            display: none;
        }
        
        /* --- 5. Editor & Stats --- */
        .editor-wrapper {
            flex-grow: 1;
            position: relative;
            overflow-y: auto;
        }

        .tox-tinymce {
            border-radius: var(--border-radius) !important;
            border: 3px solid var(--bg-tertiary) !important;
        }
        
        /* Word/character count display below the editor */
        #stats-display {
            padding: 8px 5px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: right;
            line-height: 1.4;
            flex-shrink: 0;
        }

        /* --- 6. Utility Styles --- */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: var(--border-radius);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <audio id="key-sound-1" src="sounds/tp1.mp3" preload="auto"></audio>
    <audio id="key-sound-2" src="sounds/tp2.mp3" preload="auto"></audio>
    <audio id="key-sound-3" src="sounds/tp3.mp3" preload="auto"></audio>
    <audio id="key-sound-4" src="sounds/tp4.mp3" preload="auto"></audio>
    <audio id="return-sound" src="sounds/cr1.mp3" preload="auto"></audio>
    <audio id="space-sound" src="sounds/sp2.mp3" preload="auto"></audio>

    <div id="app-container">
        <div id="sidebar">
            <h3 id="chapters-title" >be a good duck.</h3>
            <div id="tab-list"></div>
            <div id="sidebar-toolbar">
                <button id="move-up-btn" title="Move Chapter Up">
                    <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" transform="matrix(1, 0, 0, -1, 0, 0)"><path d="M18.71,17.29a1,1,0,0,0-1.42,0L16,18.59V16.71A11.78,11.78,0,0,0,9.45,6.11a1,1,0,0,0-.9,1.78A9.81,9.81,0,0,1,14,16.71v1.88l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,1.42,0l3-3A1,1,0,0,0,18.71,17.29Z" fill="#2ca9bc"></path><path d="M8,22H5a2,2,0,0,1-2-2V4A2,2,0,0,1,5,2H19a2,2,0,0,1,2,2v8a1,1,0,0,1-2,0V4H5V20H8a1,1,0,0,1,0,2Z" fill="currentColor"></path></svg>
                </button>
                <button id="move-down-btn" title="Move Chapter Down">
                    <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18.71,17.29a1,1,0,0,0-1.42,0L16,18.59V16.71A11.78,11.78,0,0,0,9.45,6.11a1,1,0,0,0-.9,1.78A9.81,9.81,0,0,1,14,16.71v1.88l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,1.42,0l3-3A1,1,0,0,0,18.71,17.29Z" fill="#2ca9bc"></path><path d="M8,22H5a2,2,0,0,1-2-2V4A2,2,0,0,1,5,2H19a2,2,0,0,1,2,2v8a1,1,0,0,1-2,0V4H5V20H8a1,1,0,0,1,0,2Z" fill="currentColor"></path></svg>
                </button>
                <button id="new-tab-btn" title="New Chapter">
                    <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7,10h6M10,7v6" fill="none" stroke="#2ca9bc" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M7,21H17a4,4,0,0,0,4-4V5" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><rect x="3" y="3" width="14" height="14" rx="1" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></rect></svg>
                </button>
                <button id="custom-print-btn" title="Print Chapter (Ctrl+P)">
                    <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18,17h2a1,1,0,0,0,1-1V7a1,1,0,0,0-1-1H4A1,1,0,0,0,3,7v9a1,1,0,0,0,1,1H6" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><line x1="8" y1="3" x2="16" y2="3" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><rect x="6" y="14" width="12" height="7" fill="none" stroke="#2ca9bc" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></rect><line x1="16.95" y1="10" x2="17.05" y2="10" fill="none" stroke="#2ca9bc" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line></svg>
                </button>
                <button id="custom-print-all-btn" title="Print All Chapters (Ctrl+Shift+P)">
                    <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17,16h3a1,1,0,0,0,1-1V7a1,1,0,0,0-1-1H4A1,1,0,0,0,3,7v8a1,1,0,0,0,1,1H7" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><line x1="8" y1="3" x2="16" y2="3" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><rect x="7" y="11" width="10" height="10" fill="none" stroke="#2ca9bc" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></rect></svg>
                </button>
                
                <button id="duck-export-btn" title="Quacksave All (Ctrl+Q)">
                    <svg fill="#2ca9bc" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30px" height="30px" viewBox="0 0 359.607 359.606" xml:space="preserve" stroke="#2ca9bc"><g><path d="M303.934,40.65c-0.651-0.758-1.419-1.346-2.229-1.845c-0.214-0.53-0.469-1.054-0.786-1.553 C281.002,6.088,233.275-3.374,200.771,17.396c-29.858,19.083-48.92,60.283-27.714,93.459c3.288,5.288,9.989,18.2,13.225,30.851 c-0.879,0.082-1.763,0.25-2.624,0.594c-0.274,0.112-27.629,11.049-57.378,15.083c-36.645,4.984-59.57-2.208-68.101-21.337 c-2.762-6.198-11.149-25.054-26.12-22.131c-26.305,5.17-31.938,85.724-31.962,86.527c-2.755,87.927,53.201,144.866,149.678,152.326 c4.533,0.353,9.079,0.518,13.643,0.518c51.853,0,104.87-22.22,135.243-57.562c20.812-24.204,29.617-52.457,25.867-82.307 c-0.013-0.25,0.023-0.499,0-0.755c-0.901-9.146-8.976-89.961-15.467-109.988c-0.024-0.082-0.049-0.155-0.067-0.226 c2.284-1.065,7.423-2.101,10.991-2.825c10.717-2.162,24.04-4.85,32.352-15.138l7.271-9.003l-10.333-5.222 C339.483,65.324,312.24,50.354,303.934,40.65z M284.473,283.541c-28.899,33.618-83.744,54.449-133.265,50.588 c-86.594-6.697-134.862-55.21-132.417-133.096c0.53-16.977,8.884-58.901,16.279-67.782c1.23,1.397,3.325,4.366,6.025,10.416 c26.223,58.815,126.259,24.752,146.194,17.274c-0.061,0.244-0.091,0.512-0.164,0.755c-1.349,4.335-4.098,7.277-8.656,9.28 c-4.731,2.076-6.89,7.587-4.813,12.318c1.541,3.514,4.969,5.608,8.574,5.608c1.254,0,2.524-0.256,3.748-0.786 c9.489-4.158,16.072-11.374,19.007-20.864c8.142-26.192-13.53-62.234-16.1-66.362c-14.568-22.807-0.408-53.436,21.964-67.733 c23.376-14.946,60.191-7.925,74.312,14.172c0.676,1.054,1.528,1.921,2.491,2.601c0.158,15.438,1.041,30.844,2.009,46.253 c0.067,1.096,0.329,2.058,0.67,2.956c-0.39,2.893-0.146,5.992,0.938,9.319c4.227,13.034,10.12,62.929,13.25,92.537 c-0.535,1.583-0.67,3.324-0.268,5.078C310.753,234.133,303.921,260.92,284.473,283.541z"></path><path d="M215.507,222.491c-13.384-11.351-31.624-18.438-51.371-19.96c-5.188-0.329-9.646,3.452-10.047,8.604 c-0.399,5.151,3.456,9.645,8.607,10.047c15.856,1.225,30.318,6.753,40.719,15.576c9.535,8.086,14.37,17.945,13.615,27.754 c-0.756,9.804-7.046,18.804-17.714,25.331c-11.63,7.124-26.762,10.364-42.627,9.134c-5.185-0.354-9.646,3.465-10.044,8.604 c-0.399,5.151,3.456,9.651,8.604,10.047c2.658,0.207,5.307,0.305,7.931,0.305c16.891,0,32.951-4.214,45.909-12.13 c15.917-9.742,25.367-23.894,26.604-39.854C236.929,249.996,229.744,234.565,215.507,222.491z"></path><path d="M250.167,52.53c-12.068,0-12.068,18.706,0,18.706C262.229,71.236,262.229,52.53,250.167,52.53z"></path></g></svg>
                </button>
            </div>
        </div>

        <div id="main-content">
            <div id="custom-toolbar">
                <button id="toggle-fullscreen-btn" title="Fullscreen (F11)">
                    <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                    </svg>
                </button>
                <div class="toolbar-separator"></div>
                <button id="custom-undo-btn" title="Undo (Ctrl+Z)"><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16.5,8H5.41l1.3-1.29A1,1,0,0,0,5.29,5.29l-3,3a1,1,0,0,0,0,1.42l3,3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42L5.41,10H16.5a3.5,3.5,0,0,1,0,7H13a1,1,0,0,0,0,2h3.5a5.5,5.5,0,0,0,0-11Z" fill="currentColor"></path></svg></button>
                <button id="custom-redo-btn" title="Redo (Ctrl+Y)"><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21.71,8.29l-3-3a1,1,0,0,0-1.42,1.42L18.59,8H7.5a5.5,5.5,0,0,0,0,11H11a1,1,0,0,0,0-2H7.5a3.5,3.5,0,0,1,0-7H18.59l-1.3,1.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0l3-3A1,1,0,0,0,21.71,8.29Z" fill="currentColor"></path></svg></button>

                <div class="toolbar-separator"></div>
                <button id="custom-bold-btn" title="Bold (Ctrl+B)" ><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16.42,11.35A5.45,5.45,0,0,0,18,7.5,5.51,5.51,0,0,0,12.5,2H5A1,1,0,0,0,5,4H6V20H5a1,1,0,0,0,0,2h9.5a5.5,5.5,0,0,0,1.92-10.65ZM12.5,4a3.5,3.5,0,0,1,0,7H8V4Zm2,16H8V13h6.5a3.5,3.5,0,0,1,0,7Z" fill="currentColor"></path></svg></button>
                <button id="custom-italic-btn" title="Italic (Ctrl+I)"><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8,22a1,1,0,0,1,0-2H9.65L12.32,4H11a1,1,0,0,1,0-2h5a1,1,0,0,1,0,2H14.35L11.68,20H13a1,1,0,0,1,0,2Z" fill="currentColor"></path></svg></button>
                
                <div class="toolbar-separator"></div>
                <button id="custom-h1-btn" title="Heading 1"><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21,20H17a1,1,0,0,1,0-2h1V10.62l-.55.27a1,1,0,0,1-.9-1.78l2-1A1,1,0,0,1,20,9v9h1a1,1,0,0,1,0,2Z" fill="#2ca9bc"></path><path d="M13,20H11a1,1,0,0,1,0-2V13H5v5a1,1,0,0,1,0,2H3a1,1,0,0,1,0-2V6A1,1,0,0,1,3,4H5A1,1,0,0,1,5,6v5h6V6a1,1,0,0,1,0-2h2a1,1,0,0,1,0,2V18a1,1,0,0,1,0,2Z" fill="currentColor"></path></svg></button>
                <button id="custom-h2-btn" title="Heading 2"><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21,20H16a1,1,0,0,1-1-1,5.93,5.93,0,0,1,3-5.14l1.26-.72A1.51,1.51,0,0,0,20,11.83V11.5a1.5,1.5,0,0,0-3,0V12a1,1,0,0,1-2,0v-.5a3.5,3.5,0,0,1,7,0v.33a3.51,3.51,0,0,1-1.76,3L19,15.59A4,4,0,0,0,17.13,18H21a1,1,0,0,1,0,2Z" fill="#2ca9bc"></path><path d="M12,20H10a1,1,0,0,1,0-2V13H5v5a1,1,0,0,1,0,2H3a1,1,0,0,1,0-2V6A1,1,0,0,1,3,4H5A1,1,0,0,1,5,6v5h5V6a1,1,0,0,1,0-2h2a1,1,0,0,1,0,2V18a1,1,0,0,1,0,2Z" fill="currentColor"></path></svg></button>
                <button id="custom-h3-btn" title="Heading 3"><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19,20H18a3,3,0,0,1-3-3,1,1,0,0,1,2,0,1,1,0,0,0,1,1h1a1,1,0,0,0,1-1V15a1,1,0,0,0-1-1h-.75a1,1,0,0,1-.82-1.57L19.1,10H16a1,1,0,0,1,0-2h5a1,1,0,0,1,.82,1.57L20,12.18A3,3,0,0,1,22,15v2A3,3,0,0,1,19,20Z" fill="#2ca9bc"></path><path d="M12,20H10a1,1,0,0,1,0-2V13H5v5a1,1,0,0,1,0,2H3a1,1,0,0,1,0-2V6A1,1,0,0,1,3,4H5A1,1,0,0,1,5,6v5h5V6a1,1,0,0,1,0-2h2a1,1,0,0,1,0,2V18a1,1,0,0,1,0,2Z" fill="currentColor"></path></svg></button>
            </div>

            <div class="editor-wrapper">
                <textarea id="editor"></textarea>
            </div>
            
            <div id="stats-display">Chapter: 0 words / 0 chars<br>Total: 0 words / 0 chars</div>
        </div>
        
        <div id="right-sidebar">
            <div id="tools-container">
                
                <div class="tool-section">
                    <button id="toggle-file-btn" title="File Operations">
                        <svg width="18" height="18" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 8 L 4 26 L 28 26 L 28 12 L 16 12 L 14 8 Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </button>
                    <label for="toggle-file-btn">file operations</label>
                    <div id="file-controls-container">
                        <button id="custom-open-btn" title="Open File"><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.71,17.29a1,1,0,0,0-1.42,0L13,18.59V7a1,1,0,0,0-2,0V18.59l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,1.42,0l3-3A1,1,0,0,0,15.71,17.29Z" fill="#2ca9bc"></path><path d="M19,15H16a1,1,0,0,1,0-2h3V4H5v9H8a1,1,0,0,1,0,2H5a2,2,0,0,1-2-2V4A2,2,0,0,1,5,2H19a2,2,0,0,1,2,2v9A2,2,0,0,1,19,15Z" fill="currentColor"></path></svg></button>
                        <button id="custom-save-as-btn" title="Save Chapter (Ctrl+S)"><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.71,13.29a1,1,0,0,0-1.42,0L13,14.59V3a1,1,0,0,0-2,0V14.59l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,1.42,0l3-3A1,1,0,0,0,15.71,13.29Z" fill="#2ca9bc"></path><path d="M19,22H5a2,2,0,0,1-2-2V11A2,2,0,0,1,5,9H8a1,1,0,0,1,0,2H5v9H19V11H16a1,1,0,0,1,0-2h3a2,2,0,0,1,2,2v9A2,2,0,0,1,19,22Z" fill="currentColor"></path></svg></button>
                        <button id="custom-save-all-btn" title="Save All Chapters (Separately)"><svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.71,13.29a1,1,0,0,1,0,1.42l-3,3a1,1,0,0,1-1.42,0l-3-3a1,1,0,0,1,1.42-1.42L12,15.59l2.29-2.3A1,1,0,0,1,15.71,13.29Zm-4.42-.58a1,1,0,0,0,1.42,0l3-3a1,1,0,0,0-1.42-1.42L13,9.59V3a1,1,0,0,0-2,0V9.59L9.71,8.29A1,1,0,0,0,8.29,9.71Z" fill="#2ca9bc"></path><path d="M19,22H5a2,2,0,0,1-2-2V17a1,1,0,0,1,2,0v3H19V17a1,1,0,0,1,2,0v3A2,2,0,0,1,19,22Z" fill="currentColor"></path></svg></button>
                    </div>
                </div>

                <div class="tool-section">
                    <button id="toggle-colors-btn" title="Ink and Paper Settings">
                        <svg width="18" height="18" viewBox="0 0 512 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M470.314,392.915l-40.059-0.264c-0.043,0-0.083,0-0.117,0c-9.308,0-16.885,7.512-16.944,16.828 c-0.058,9.365,7.473,16.993,16.829,17.06l18.814,0.123c-5.874,10.357-16.995,17.357-29.727,17.383h-0.141 c-18.814-0.049-34.112-15.356-34.112-34.186V284.557c-10.441,8.107-21.918,16.232-33.888,23.258v102.044 c0,12.51,3.631,24.101,9.546,34.186H179.634c-23.969,0-43.461-19.492-43.461-43.46V87.755c0-12.508-3.631-24.1-9.548-34.185 h180.883c23.969,0,43.462,19.493,43.462,43.46v13.478c10.556-8.033,21.634-15.694,32.927-22.992 c-4.756-38.133-36.999-67.834-76.389-67.834c0,0-239.881,0.049-239.964,0.049C30.255,20.03,0,50.409,0,87.755 c0,9.317,7.519,16.886,16.829,16.944l40.059,0.266c0.042,0,0.083,0,0.117,0c9.308,0,16.885-7.513,16.944-16.829 c0.058-9.365-7.473-16.993-16.829-17.059l-18.815-0.125C44.18,60.594,55.3,53.594,68.032,53.57h0.141 c18.814,0.049,34.112,15.355,34.112,34.185v312.83c0,42.649,34.7,77.349,77.35,77.349c0,0,239.881-0.049,239.964-0.049 c37.288-0.299,67.544-30.68,67.544-68.026C487.143,400.544,479.621,392.972,470.314,392.915z"></path> <path id="XMLID_117_" d="M495.291,70.348c-1.521-1.521-3.548-2.316-5.6-2.316c-1.183,0-2.382,0.264-3.492,0.81 c-34.293,16.846-104.104,53.803-143.586,93.292c-43.767,43.758-71.74,89.8-71.565,114.497l-26.989,26.988l-34.235,34.235 l41.93-5.989l10.358-10.358l26.923-26.922c0.074,0,0.132,0.032,0.206,0.032c24.738,0,70.64-27.957,114.266-71.583 c14.163-14.163,27.962-32.273,40.664-51.204l-9.201-9.2l15.199-0.009c3.433-5.32,6.791-10.615,10.011-15.926l-17.226-5.039 l25.631-9.233c11.781-20.468,21.593-39.49,28.22-52.984C498.304,76.396,497.684,72.739,495.291,70.348z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ></path>
                        </svg>
                    </button>
                    <label for="toggle-colors-btn">ink & paper</label>
                    <div id="color-picker-container">
                        <svg width="20" height="20" viewBox="0 0 24 24"  xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4L6.81877 13.8657C7.51796 16.3128 9.45494 18 12 18C12.575 18 13.1499 17.8953 13.7037 17.7037L15.5858 19.5858C16.3668 20.3668 17.6332 20.3668 18.4142 19.5858L19.5858 18.4142C20.3668 17.6332 20.3668 16.3668 19.5858 15.5858L17.7083 13.7083C17.8964 13.1601 18 12.5852 18 12C18 9.45494 16.3128 7.51796 13.8657 6.81877L4 4ZM4 4L11.2929 11.2929M11.2929 11.2929C11.1119 11.4739 11 11.7239 11 12C11 12.5523 11.4477 13 12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.7239 11 11.4739 11.1119 11.2929 11.2929Z" stroke="currentColor" stroke-width="1.5"></path>
                        </svg>
                        <input type="color" id="editor-text-color" title="Editor Text Color" value="#d4d4d4">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9.29289 1.29289C9.48043 1.10536 9.73478 1 10 1H18C19.6569 1 21 2.34315 21 4V20C21 21.6569 19.6569 23 18 23H6C4.34315 23 3 21.6569 3 20V8C3 7.73478 3.10536 7.48043 3.29289 7.29289L9.29289 1.29289ZM18 3H11V8C11 8.55228 10.5523 9 10 9H5V20C5 20.5523 5.44772 21 6 21H18C18.5523 21 19 20.5523 19 20V4C19 3.44772 18.5523 3 18 3ZM6.41421 7H9V4.41421L6.41421 7Z"></path>
                        </svg>
                        <input type="color" id="editor-bg-color" title="Editor Background Color" value="#2d2d2d">
                    </div>
                </div>

                <div class="tool-section">
                    <button id="toggle-settings-btn" title="Settings">
                        <svg width="18" height="18" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M39.23,26a16.52,16.52,0,0,0,.14-2,16.52,16.52,0,0,0-.14-2l4.33-3.39a1,1,0,0,0,.25-1.31l-4.1-7.11a1,1,0,0,0-1.25-.44l-5.11,2.06a15.68,15.68,0,0,0-3.46-2l-.77-5.43a1,1,0,0,0-1-.86H19.9a1,1,0,0,0-1,.86l-.77,5.43a15.36,15.36,0,0,0-3.46,2L9.54,9.75a1,1,0,0,0-1.25.44L4.19,17.3a1,1,0,0,0,.25,1.31L8.76,22a16.66,16.66,0,0,0-.14,2,16.52,16.52,0,0,0,.14,2L4.44,29.39a1,1,0,0,0-.25,1.31l4.1,7.11a1,1,0,0,0,1.25.44l5.11-2.06a15.68,15.68,0,0,0,3.46,2l.77,5.43a1,1,0,0,0,1,.86h8.2a1,1,0,0,0,1-.86l.77-5.43a15.36,15.36,0,0,0,3.46-2l5.11,2.06a1,1,0,0,0,1.25-.44l4.1-7.11a1,1,0,0,0-.25-1.31ZM24,31.18A7.18,7.18,0,1,1,31.17,24,7.17,7.17,0,0,1,24,31.18Z" stroke="currentColor" stroke-width="2.5" ></path>
                        </svg>
                    </button>
                    <label for="toggle-settings-btn">editor settings</label>
                    <div id="settings-container">
                        <button id="toggle-font-btn" title="Toggle Font Style">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 5C3 4.44772 3.44772 4 4 4H12H20C20.5523 4 21 4.44772 21 5V7C21 7.55228 20.5523 8 20 8C19.4477 8 19 7.55228 19 7V6H13V19H15C15.5523 19 16 19.4477 16 20C16 20.5523 15.5523 21 15 21H12H9C8.44772 21 8 20.5523 8 20C8 19.4477 8.44772 19 9 19H11V6H5V7C5 7.55228 4.55228 8 4 8C3.44772 8 3 7.55228 3 7V5Z" fill="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button id="toggle-sounds-btn" title="Toggle Typewriter Sounds">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11 5L6 9H2V15H6L11 19V5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                <path d="M15.54 8.46C16.48 9.4 17 10.62 17 12C17 13.38 16.48 14.6 15.54 15.54" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                        </button>
                    </div>
                </div>

                <div class="tool-section">
                    <button id="toggle-export-btn" title="Export">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17 17L22 12L17 7M7 7L2 12L7 17M14 3L10 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </button>
                    <label for="toggle-export-btn">project import/export</label>
                    <div id="export-container">
                        <button id="custom-import-btn" title="Import Project">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.71,13.29a1,1,0,0,1,0,1.42l-3,3a1,1,0,0,1-1.42,0l-3-3a1,1,0,0,1,1.42-1.42L12,15.59l2.29-2.3A1,1,0,0,1,15.71,13.29Zm-4.42-.58a1,1,0,0,0,1.42,0l3-3a1,1,0,0,0-1.42-1.42L13,9.59V3a1,1,0,0,0-2,0V9.59L9.71,8.29A1,1,0,0,0,8.29,9.71Z" fill="#2ca9bc"></path>
                                <path d="M20,22H4a2,2,0,0,1-2-2V11A2,2,0,0,1,4,9H5a1,1,0,0,1,0,2H4v9H20V11H19a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v9A2,2,0,0,1,20,22Z" fill="currentColor"></path>
                            </svg>
                        </button>
                        <button id="custom-export-all-btn" title="Export Project (Quacksave)">
                            <svg width="18" height="18" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8.29,6.71a1,1,0,0,1,0-1.42l3-3a1,1,0,0,1,1.42,0l3,3a1,1,0,0,1,0,1.42,1,1,0,0,1-1.42,0L12,4.41,9.71,6.71A1,1,0,0,1,8.29,6.71Zm4.42.58a1,1,0,0,0-1.42,0l-3,3a1,1,0,0,0,1.42,1.42L11,10.41V17a1,1,0,0,0,2,0V10.41l1.29,1.3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42Z" fill="#2ca9bc"></path>
                                <path d="M20,22H4a2,2,0,0,1-2-2V11A2,2,0,0,1,4,9H5a1,1,0,0,1,0,2H4v9H20V11H19a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v9A2,2,0,0,1,20,22Z" fill="currentColor"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
          
           <div id="deco-container">
                <svg id="deco-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0, 0, 544.771, 624.59">
        <g id="Layer_1" transform="translate(-1, -1)">
            <path d="M347.412,515.743 C347.521,517.472 348.694,518.742 349.407,520.192 C351.064,523.578 352.865,526.879 354.606,530.228 C355.643,532.304 356.895,534.265 358.342,536.08 C359.179,537.137 360.338,537.893 361.643,538.232 C364.521,539.018 367.386,539.912 370.227,540.855 C371.311,541.266 372.369,541.743 373.395,542.282 C374.604,542.85 375.813,543.491 377.083,543.963 C381.683,545.76 385.901,548.415 389.512,551.785 C390.37,552.571 391.168,553.405 392.051,554.203 C395.012,556.855 397.434,560.053 399.184,563.622 C400.067,565.339 400.962,567.056 401.808,568.797 C404.064,573.208 405.142,578.126 404.94,583.076 C404.657,589.068 403.761,595.015 402.268,600.825 C401.566,603.533 400.841,606.254 399.994,608.913 C398.98,612.148 398.399,615.502 398.266,618.888 C398.217,619.849 398.084,620.804 397.867,621.742 C397.736,622.102 397.443,622.379 397.076,622.489 C396.709,622.598 396.311,622.528 396.005,622.298 C395.779,622.117 395.576,621.91 395.4,621.681 C394.382,620.385 393.156,619.265 391.773,618.368 C387.987,615.667 384.011,613.243 379.876,611.114 C376.795,609.506 373.818,607.705 370.965,605.722 C367.906,603.594 365.802,600.523 363.807,597.427 C361.052,593.1 358.774,588.487 357.012,583.668 Q355.803,580.404 354.437,577.212 C353.38,574.812 352.943,572.184 353.167,569.571 C353.276,568.362 353.167,567.08 353.167,565.871 C352.466,565.569 352.212,566.016 351.958,566.379 L348.948,570.284 C346.135,573.743 342.672,576.618 338.755,578.747 C338.009,579.21 337.192,579.549 336.337,579.751 C331.935,580.877 327.438,581.597 322.905,581.903 C320.968,581.999 319.03,581.762 317.174,581.202 C316.169,580.866 315.216,580.389 314.344,579.787 C313.708,579.407 313.261,578.775 313.113,578.048 C312.966,577.321 313.132,576.565 313.571,575.967 C314.094,575.156 314.724,574.42 315.445,573.778 C316.92,572.4 318.491,571.094 319.979,569.728 C320.615,569.136 321.198,568.489 321.72,567.793 C325.504,562.655 329.301,557.528 333,552.341 C335.128,549.343 337.026,546.187 339.154,543.201 C341.182,540.251 343.53,537.534 346.155,535.1 C346.45,534.853 346.729,534.586 346.989,534.302 C349.25,531.739 348.839,531.884 347.727,529.466 C346.252,526.214 344.777,522.961 343.265,519.721 C342.83,518.766 342.528,517.69 341.415,517.23 C341.411,517.154 341.411,517.077 341.415,517.001 C341.443,516.935 341.479,516.874 341.524,516.819 L341.427,517.206 C343.072,521.68 342.286,525.96 340.303,530.095 C339.802,531.034 339.11,531.858 338.272,532.513 C337.676,533.031 336.878,533.251 336.1,533.113 C335.323,532.974 334.65,532.491 334.27,531.799 C333.774,530.978 333.464,530.058 333.363,529.103 C333.075,525.42 333.676,521.721 335.116,518.318 C335.38,517.697 335.748,517.124 336.204,516.626 C336.93,515.828 337.312,514.777 337.268,513.7 C337.221,513.298 337.221,512.892 337.268,512.491 C337.726,509.202 336.951,505.86 335.092,503.108 C334.141,501.315 333.282,499.475 332.517,497.595 C332.287,497.075 332.142,496.507 331.416,496.229 C330.905,497.372 330.626,498.604 330.594,499.856 C330.244,503.812 329.581,507.733 328.611,511.584 C327.282,517.74 324.928,523.63 321.647,529.007 C320.029,531.529 317.983,533.751 315.602,535.572 C312.869,537.712 309.968,539.658 307.138,541.617 C304.72,543.31 302.157,544.954 299.618,546.538 C294.954,549.494 289.836,551.663 284.468,552.958 C282.401,553.43 280.382,554.167 278.326,554.699 C277.871,554.836 277.407,554.937 276.936,555.001 C276.644,555.02 276.359,554.911 276.154,554.702 C275.95,554.492 275.847,554.205 275.872,553.913 C275.91,553.626 275.987,553.345 276.102,553.079 C277.018,550.528 277.654,547.885 278,545.196 C279.354,537.579 280.757,529.962 283.852,522.804 C284.892,520.386 286.016,518.04 287.08,515.658 C287.394,514.957 287.672,514.244 288.011,513.41 C287.666,512.952 287.259,512.545 286.802,512.201 C284.623,510.764 282.238,509.667 279.729,508.948 C277.311,508.428 275.267,507.618 274.01,505.321 C272.029,505.897 270.086,506.6 268.194,507.425 C266.369,508.066 264.567,508.755 262.584,509.48 C262.282,511.04 261.992,512.636 261.666,514.22 C261.097,516.964 260.529,519.709 259.912,522.453 C259.757,523.717 259.059,524.851 258.002,525.561 C257.518,526.014 257.185,526.605 257.047,527.253 C256.575,528.632 256.213,530.034 255.838,531.425 C255.56,532.392 255.149,533.262 253.976,533.359 C253.166,533.432 252.827,534.012 252.549,534.641 C252.138,535.511 251.812,536.418 251.34,537.252 C251.149,537.539 250.838,537.724 250.495,537.754 C250.152,537.785 249.814,537.658 249.575,537.41 C248.947,536.661 248.396,535.851 247.931,534.991 C247.488,534.137 246.899,533.368 246.189,532.718 C245.138,531.739 244.207,530.639 242.973,529.309 C241.288,528.946 239.834,527.888 238.971,526.395 C238.655,525.914 238.244,525.502 237.762,525.186 C236.423,524.376 235.416,523.116 234.921,521.631 C234.52,520.332 233.661,519.224 232.503,518.512 C231.79,518.137 231.354,517.303 230.738,516.541 C227.352,516.722 223.979,516.988 220.606,517.085 C217.232,517.182 213.895,517.085 210.619,517.085 C210.292,517.786 210.764,517.944 211.042,518.137 C213.035,519.503 214.836,521.13 216.398,522.973 C217.257,523.888 218.165,524.756 219.119,525.573 C219.892,526.31 220.666,527.036 221.392,527.81 C221.684,528.06 221.878,528.408 221.936,528.789 C221.742,530.905 223.145,532.416 223.919,534.133 C224.426,535.282 224.946,536.418 225.369,537.603 C225.783,538.51 225.672,539.57 225.079,540.372 C224.521,541.166 224.288,542.143 224.426,543.104 C224.499,544.264 224.499,545.427 224.426,546.586 C224.431,547.548 224.171,548.493 223.677,549.319 C222.973,550.235 222.644,551.385 222.758,552.535 C222.758,553.019 222.758,553.514 222.758,553.986 C222.933,558.338 222.571,562.695 221.682,566.959 C221.349,568.288 221.793,569.691 222.83,570.586 C226.687,574.213 230.399,578.058 234.317,581.661 C236.505,583.68 238.959,585.446 241.341,587.271 C244.968,590.016 248.596,592.7 252.223,595.457 C253.05,596.123 253.834,596.842 254.568,597.609 C256.926,599.942 259.405,602.046 262.79,602.784 C263.434,602.968 264.043,603.258 264.591,603.642 C264.826,603.819 264.947,604.109 264.907,604.4 C264.867,604.691 264.672,604.938 264.398,605.045 C263.756,605.236 263.082,605.298 262.415,605.226 C260.7,604.984 259.012,604.579 257.373,604.017 C254.955,603.05 252.646,601.804 250.3,600.668 C249.78,600.414 249.321,600.039 248.789,599.809 C244.101,597.71 239.571,595.273 235.235,592.519 C231.274,590.095 227.5,587.379 223.943,584.394 C222.31,583.052 220.654,581.722 219.106,580.428 C217.692,580.706 217.353,581.637 217.099,582.749 C216.773,584.164 216.483,585.591 216.048,586.969 C215.854,587.574 215.455,588.42 214.971,588.565 C213.545,589 213.412,590.137 213.097,591.237 C212.783,592.337 212.529,593.28 212.203,594.296 C212.039,595.291 211.203,596.036 210.196,596.085 C209.305,596.129 208.511,596.658 208.128,597.464 C207.814,597.953 207.475,598.425 207.113,598.878 C206.291,599.973 204.972,600.579 203.606,600.489 C202.24,600.398 201.012,599.624 200.342,598.431 C199.833,597.609 199.426,596.728 199.133,595.807 C198.57,594.059 198.114,592.279 197.767,590.475 C196.981,585.99 195.554,581.673 194.49,577.26 C193.281,572.098 192.265,566.862 191.334,561.639 C190.766,558.508 190.029,555.425 189.218,552.535 C188.674,552.075 188.324,552.366 188.009,552.535 C185.773,553.393 185.591,553.599 186.244,555.981 C187.152,559.654 187.222,563.485 186.45,567.189 C185.859,569.821 185.129,572.42 184.261,574.975 C183.935,576.087 183.512,577.176 183.137,578.264 C183.046,578.641 182.912,579.006 182.738,579.352 C181.214,581.613 180.489,584.261 179.207,586.606 C178.99,587.029 178.76,587.622 178.397,587.815 C176.934,588.384 176.596,589.738 175.979,590.923 C175.496,591.866 175,592.809 174.48,593.74 C174.299,594.078 174.117,594.526 173.815,594.671 C171.397,595.795 170.816,598.298 169.366,600.196 C168.773,600.958 168.35,601.84 167.745,602.614 C166.718,603.896 166.476,603.944 164.312,603.69 L161.253,606.979 C159.802,608.539 158.363,610.086 156.078,610.461 C155.558,610.546 155.099,611.041 154.603,611.332 C152.185,612.746 149.767,614.125 147.349,615.588 C146.132,616.188 145.015,616.971 144.036,617.909 C141.908,620.327 138.994,621.742 136.673,623.894 C135.775,624.93 134.385,625.393 133.045,625.103 C132.465,624.946 131.752,625.429 131.099,625.49 C130.148,625.623 129.184,625.623 128.233,625.49 C126.637,625.188 126.057,624.281 125.924,622.673 C125.533,618.821 125.687,614.934 126.383,611.126 C126.9,608.555 127.951,606.121 129.467,603.981 C131.775,600.517 134.504,597.354 137.591,594.562 C138.741,593.535 139.547,592.181 139.901,590.681 C141.001,586.872 142.319,583.148 143.528,579.388 C143.758,578.675 143.999,577.961 144.362,576.885 C143.924,577.01 143.495,577.168 143.081,577.357 C141.871,578.07 140.808,578.832 139.659,579.545 C138.961,580.05 138.087,580.247 137.241,580.089 C136.577,580.066 135.916,580.19 135.306,580.452 C133.928,580.875 132.562,581.407 131.171,581.77 C130.338,582.025 129.466,582.127 128.596,582.072 C125.041,581.734 121.499,581.286 117.956,580.863 C116.989,580.754 116.034,580.634 115.067,580.597 C113.035,580.56 111.022,580.196 109.106,579.521 C108.379,579.308 107.626,579.198 106.869,579.195 C104.366,579.025 101.851,578.917 99.349,578.759 C98.772,578.709 98.201,578.603 97.644,578.445 C96.894,578.264 96.036,578.167 95.734,577.333 C95.347,576.269 96.254,575.809 96.858,575.217 C97.303,574.856 97.652,574.391 97.874,573.863 C98.371,572.369 99.478,571.157 100.921,570.526 C103.883,568.894 106.893,567.334 109.928,565.859 C111.461,565.046 113.136,564.533 114.861,564.347 C116.48,564.05 118.053,563.542 119.54,562.836 C121.251,562.156 123.059,561.748 124.896,561.627 C125.571,561.658 126.243,561.525 126.855,561.24 C128.053,560.597 129.378,560.225 130.736,560.152 C135.035,559.451 139.398,559.232 143.746,559.499 C146.065,559.671 148.301,560.437 150.238,561.724 C150.782,562.099 151.375,562.425 151.931,562.776 C153.158,562.388 154.252,561.664 155.087,560.684 C157.505,558.411 159.778,556.09 162.123,553.78 C162.329,553.575 162.631,553.369 162.679,553.127 C163.006,551.193 164.638,550.709 166.041,549.851 C167.649,548.956 169.257,548.086 170.877,547.179 C172.425,546.248 173.324,544.532 173.21,542.729 C170.974,542.584 168.906,542.089 166.79,542.633 C165.713,542.944 164.569,542.433 164.082,541.424 C163.816,541.025 163.526,540.626 163.296,540.215 C162.628,539.104 162.709,537.698 163.502,536.672 C163.828,536.213 164.13,535.741 164.614,535.016 C163.018,534.846 161.724,534.52 160.539,535.366 C159.355,536.213 158.121,535.814 156.852,535.1 C154.494,533.891 153.865,531.679 153.309,529.418 C153.109,528.254 153.397,527.06 154.107,526.117 C154.627,525.319 155.22,524.557 155.764,523.783 C155.244,523.179 154.833,523.542 154.555,523.783 C152.271,525.624 149.229,526.225 146.418,525.391 C145.759,525.307 145.093,525.307 144.435,525.391 C143.081,525.391 141.726,525.585 140.384,525.5 C139.351,525.526 138.351,525.134 137.611,524.412 C136.872,523.691 136.455,522.701 136.455,521.668 C136.449,520.896 136.486,520.125 136.564,519.358 C136.624,518.606 136.624,517.85 136.564,517.097 C136.334,515.55 136.298,515.562 137.7,514.957 L138.752,514.486 L139.308,511.112 C138.849,510.484 138.389,510.786 137.942,510.907 L132.937,512.285 C132.279,512.443 131.639,512.666 131.026,512.95 C128.282,514.365 125.549,515.828 122.817,517.279 C122.055,517.678 121.269,518.064 120.495,518.488 C119.39,519.099 118.093,519.268 116.868,518.959 C114.583,518.437 112.187,518.719 110.085,519.757 L107.933,520.628 C105.179,521.91 102.019,522.007 99.192,520.894 C98.092,520.515 96.911,520.435 95.77,520.664 C91.046,521.073 86.287,520.726 81.672,519.636 C81.313,519.512 81.02,519.245 80.862,518.899 C80.705,518.409 80.953,517.881 81.43,517.69 C82.534,517.08 83.668,516.527 84.828,516.033 C90.692,513.724 96.108,510.52 101.658,507.57 C102.076,507.354 102.48,507.112 102.867,506.844 C106.508,504.285 110.372,502.059 114.414,500.194 C115.702,499.771 116.508,498.493 116.336,497.148 C115.911,497.02 115.473,496.943 115.03,496.918 C113.193,497.063 111.403,497.22 109.541,497.45 C104.633,497.986 99.678,497.905 94.791,497.208 C91.061,496.653 87.373,495.845 83.752,494.79 C81.418,494.173 79.036,493.726 76.691,493.146 C76.361,493.004 76.128,492.702 76.074,492.348 C76.112,491.986 76.33,491.667 76.655,491.501 C77.402,491.316 78.177,491.275 78.94,491.38 C85.826,492.564 92.84,492.828 99.796,492.166 C102.598,492.032 105.391,491.745 108.163,491.308 C111.198,490.764 114.208,489.869 117.17,489.119 C117.443,489.037 117.7,488.91 117.932,488.745 C118.198,488.526 118.357,488.204 118.371,487.86 C118.385,487.516 118.252,487.183 118.005,486.943 C117.702,486.708 117.351,486.543 116.977,486.46 C112.141,485.601 108.006,482.893 103.387,481.466 C101.465,480.874 100.207,479.29 98.853,477.96 C98.313,477.382 98.029,476.609 98.068,475.819 C98.107,475.028 98.464,474.287 99.059,473.764 C99.744,473.083 100.471,472.445 101.235,471.854 C102.265,471.108 103.096,470.12 103.653,468.976 C104.159,467.926 104.935,467.029 105.902,466.377 C108.204,464.607 110.749,463.177 113.458,462.133 C114.632,461.902 115.688,461.27 116.445,460.344 L108.659,446.343 C108.323,446.546 108.007,446.781 107.715,447.044 C103.093,452.142 98.197,456.986 93.05,461.553 C92.196,462.211 91.74,463.261 91.84,464.334 C91.938,467.991 91.314,471.631 90.003,475.046 C88.395,479.507 85.868,483.57 81.539,486.133 C79.29,487.463 77.174,489.011 74.877,490.244 C73.422,490.998 71.867,491.539 70.259,491.852 C66.184,492.698 62.085,493.351 57.999,494.125 C56.409,494.482 54.79,494.696 53.162,494.766 C51.337,494.766 49.535,495.104 47.698,495.31 C46.084,495.594 44.425,495.486 42.861,494.996 C41.992,494.743 41.464,493.862 41.652,492.976 C41.721,492.502 41.826,492.033 41.967,491.574 C42.474,489.603 43.006,487.657 43.478,485.686 C43.69,484.64 44.227,483.687 45.013,482.965 C46.375,481.727 47.405,480.169 48.012,478.431 C49.221,475.131 51.833,472.906 54.444,470.73 C55.653,469.678 57.068,468.747 58.398,467.792 C59.96,466.693 61.257,465.26 62.194,463.596 C63.237,461.59 65.208,460.231 67.454,459.969 C69.872,459.582 72.399,459.123 74.877,458.675 C75.358,458.604 75.792,458.348 76.086,457.962 C75.777,457.92 75.464,457.92 75.155,457.962 C73.756,458.446 72.205,458.162 71.069,457.212 C70.128,456.234 68.793,455.736 67.442,455.858 C66.365,455.991 65.713,455.121 65.386,454.129 C65.126,453.402 64.932,452.654 64.806,451.892 C64.697,451.131 64.709,450.357 64.673,449.414 L62.968,448.604 C62.629,448.422 62.17,448.302 61.989,448.011 C60.502,445.593 58.023,443.755 57.394,440.817 C57.224,439.576 57.151,438.322 57.177,437.069 C57.077,436.907 56.96,436.757 56.826,436.622 C54.553,434.687 54.517,434.409 56.282,431.931 C56.391,431.771 56.484,431.601 56.56,431.423 C55.484,429.343 55.484,429.343 56.56,426.067 C56.453,425.792 56.229,425.578 55.95,425.482 C55.67,425.387 55.363,425.419 55.109,425.571 C53.586,426.188 52.062,426.78 50.599,427.542 C45.276,430.095 39.655,431.971 33.866,433.128 C30.605,433.65 27.263,433.283 24.193,432.064 C22.56,431.425 21.128,430.361 20.046,428.981 C19.141,427.839 17.982,426.924 16.661,426.309 C16.074,426.006 15.549,425.596 15.113,425.1 C14.061,423.975 13.034,422.814 12.066,421.605 C11.585,421.011 11.198,420.346 10.918,419.635 C10.319,417.887 9.233,416.347 7.786,415.197 C7.462,414.98 7.176,414.71 6.94,414.399 C5.341,412.012 3.605,409.719 1.741,407.532 C0.906,406.435 0.765,404.959 1.378,403.723 C2.261,401.305 3.966,400.386 6.348,399.927 C10.638,399.149 15.046,399.302 19.272,400.374 C24.885,401.842 30.405,403.646 35.8,405.779 C37.946,406.431 39.825,407.758 41.156,409.563 C41.616,410.252 42.632,410.567 43.103,411.256 C44.941,413.855 47.625,415.367 50.152,417.084 C50.828,417.624 51.462,418.214 52.05,418.849 C52.577,419.389 53.138,419.894 53.731,420.36 C54.136,420.64 54.652,420.707 55.116,420.539 C55.579,420.37 55.932,419.989 56.064,419.514 C56.27,418.87 56.444,418.216 56.584,417.555 C56.818,416.463 57.829,415.716 58.942,415.814 C59.616,415.778 60.291,415.86 60.937,416.056 C62.043,416.416 63.213,416.54 64.371,416.419 C66.553,416.138 68.663,417.315 69.569,419.32 C70.196,420.412 70.969,421.412 71.867,422.295 C72.385,422.706 72.995,422.988 73.644,423.117 C79.085,424.846 84.526,426.49 89.966,428.267 C92.07,428.956 94.113,429.863 96.145,430.758 C97.973,431.654 99.974,432.141 102.009,432.185 C102.265,432.141 102.514,432.059 102.746,431.943 C102.359,431.205 101.67,431.604 101.174,431.399 C99.893,430.867 98.454,430.661 98.212,428.727 C97.885,427.619 97.301,426.604 96.507,425.765 C95.553,424.621 95.395,423.01 96.108,421.702 C96.14,421.461 96.14,421.217 96.108,420.977 C95.576,420.445 94.899,419.852 94.404,419.199 C93.915,418.696 93.803,417.936 94.126,417.313 C94.409,416.667 95.082,416.284 95.782,416.37 C96.991,416.467 98.067,416.66 99.409,416.842 C99.474,416.276 99.498,415.706 99.482,415.137 C99.482,414.266 99.143,413.408 99.167,412.55 C99.335,410.654 98.107,408.916 96.266,408.439 C92.372,409.781 88.274,411.159 84.175,412.61 C82.84,413.175 81.424,413.526 79.98,413.65 C77.434,413.8 74.939,412.9 73.076,411.159 C71.359,409.599 69.678,408.003 67.901,406.528 C66.141,405.027 64.292,403.634 62.363,402.357 C60.61,401.122 59.284,399.373 58.567,397.352 C56.633,392.938 54.625,388.538 52.655,384.137 C52.147,382.988 51.651,381.827 51.119,380.703 C50.587,379.578 50.104,378.418 49.402,377.305 C48.016,374.857 47.213,372.122 47.057,369.313 C46.982,368.822 47.127,368.323 47.453,367.949 C47.779,367.574 48.253,367.361 48.749,367.367 C49.511,367.282 50.297,367.367 51.071,367.294 C52.413,367.294 53.767,367.21 55.121,367.185 C58.116,367.065 61.107,367.513 63.935,368.503 C66.358,369.222 68.634,370.364 70.658,371.877 C71.378,372.361 72.148,372.766 72.955,373.086 C74.406,373.859 75.905,374.549 77.283,375.431 C81.6,378.176 85.868,381.005 90.148,383.822 C90.69,384.242 91.4,384.377 92.058,384.185 C94.557,383.263 97.266,383.074 99.869,383.641 C100.195,383.375 100.437,383.278 100.485,383.133 Q102.033,377.402 103.556,371.659 C103.994,370.585 103.544,369.355 102.516,368.818 C101.658,369.177 100.819,369.581 100.002,370.027 C96.096,372.53 92.119,372.276 88.104,370.426 C86.787,369.809 85.529,369.084 84.248,368.395 C81.708,367.016 79.169,365.602 76.618,364.223 C74.708,363.196 74.599,363.014 75.216,360.789 C75.849,358.152 76.911,355.636 78.359,353.342 C79.368,351.633 80.288,349.873 81.116,348.07 C80.451,347.623 79.907,347.163 79.218,346.801 C76.965,345.663 74.938,344.127 73.233,342.267 C72.411,341.298 71.262,340.666 70.005,340.489 C67.245,339.9 64.721,338.507 62.75,336.487 C60.562,334.444 58.313,332.473 56.052,330.502 C55.479,330.104 55.238,329.375 55.46,328.713 C55.866,327.424 56.367,326.168 56.959,324.953 C58.918,321.326 60.961,317.698 63.113,313.781 C61.312,310.226 62.182,306.333 62.932,302.44 C63.319,300.457 63.826,298.486 64.31,296.516 C64.5,295.764 64.739,295.025 65.023,294.303 C65.458,292.748 66.918,291.707 68.53,291.8 C70.087,291.842 71.618,291.394 72.907,290.519 C75.82,288.633 78.71,286.71 81.6,284.8 C81.6,284.268 81.14,284.328 80.79,284.244 C79,283.821 77.162,283.47 75.446,282.938 C73.38,282.342 71.639,280.944 70.609,279.057 C69.824,277.73 69.145,276.343 68.578,274.91 C67.284,271.283 66.16,267.559 64.951,263.883 C64.504,262.493 64.685,262.045 65.991,261.259 C68.247,259.76 70.741,258.652 73.366,257.983 C75.166,257.476 76.935,256.863 78.662,256.145 C78.48,255.456 78.347,254.936 78.178,254.392 C77.312,252.024 76.902,249.513 76.969,246.992 C77.025,245.918 76.695,244.859 76.038,244.006 C74.354,241.617 73.446,238.768 73.438,235.845 C73.33,232.955 73.003,230.078 72.761,226.958 C73.308,226.109 74.185,225.526 75.18,225.35 C78.928,224.069 82.712,222.932 86.484,221.723 C86.876,221.602 87.283,221.541 87.693,221.542 C90.776,221.542 93.884,221.469 96.955,221.759 C100.901,222.358 103.96,225.521 104.427,229.485 C104.608,231.117 104.959,232.726 105.068,234.321 C105.176,235.917 105.068,237.405 105.068,238.976 C105.894,239.076 106.706,239.275 107.486,239.569 C108.14,240.032 108.73,240.581 109.239,241.201 C109.901,240.3 110.11,239.145 109.807,238.07 C109.488,236.659 109.022,235.285 108.417,233.971 C106.748,230.694 104.923,227.514 103.181,224.298 C102.407,222.734 101.187,221.434 99.675,220.562 C97.015,219.087 95.165,216.645 93.195,214.396 C91.224,212.147 91.635,211.373 87.669,212.703 C85.448,213.408 83.111,213.671 80.79,213.477 C76.252,213.491 72.315,210.348 71.323,205.921 C71.009,204.792 70.787,203.639 70.658,202.475 C70.319,199.597 70.029,196.707 69.751,193.83 C69.672,193.062 69.672,192.288 69.751,191.521 C69.799,190.817 70.282,190.218 70.96,190.021 C74.261,188.945 77.537,187.736 80.886,186.854 C84.907,185.844 89.169,186.779 92.397,189.381 C95.211,191.544 96.852,194.899 96.834,198.449 C96.939,200.882 96.59,203.313 95.806,205.618 L95.153,207.553 C94.862,208.288 94.996,209.123 95.504,209.729 C97.692,212.437 99.76,215.267 102.903,216.983 C104.274,217.731 105.405,218.85 106.168,220.212 C107.377,222.315 108.501,224.443 109.686,226.547 C110.424,227.889 111.21,229.207 112.104,230.706 C113.507,229.497 113.724,227.853 114.414,226.535 C115.103,225.217 115.623,223.911 116.251,222.497 C115.671,221.638 115.115,220.852 114.607,220.079 C113.733,218.804 112.926,217.484 112.189,216.125 C109.976,211.712 110.738,207.456 113.253,203.454 C115.117,200.224 118.232,197.905 121.861,197.046 C122.974,196.792 124.062,196.441 125.392,196.067 C125.005,195.317 124.739,194.725 124.413,194.193 C121.75,189.785 120.152,184.817 119.746,179.684 C119.487,177.676 119.108,175.685 118.609,173.723 C118.222,171.946 118.295,171.728 119.818,171.039 C121.212,170.348 122.728,169.937 124.28,169.83 C124.859,169.819 125.434,169.721 125.984,169.54 C130.41,167.98 135.064,167.69 139.635,166.94 C141.061,166.711 142.5,166.529 144.132,166.287 C144.019,165.806 143.832,165.345 143.576,164.921 C142.721,163.907 141.787,162.961 140.783,162.092 C139.728,161.242 138.59,160.501 137.386,159.879 C135.151,158.729 133.05,157.334 131.123,155.72 C130.397,155.104 129.563,154.62 128.705,154.04 C127.442,155.005 126.417,156.245 125.706,157.667 C124.431,159.716 122.501,161.275 120.229,162.092 C118.219,162.795 116.118,163.203 113.99,163.301 C113.122,163.327 112.26,163.144 111.476,162.769 C105.986,160.351 102.541,156.47 102.154,150.267 C101.924,146.507 101.694,142.735 101.344,138.987 C101.191,137.83 101.648,136.677 102.553,135.94 C105.122,133.316 108.01,131.026 111.149,129.121 C113.436,127.866 116.013,127.236 118.621,127.295 C119.978,127.309 121.332,127.427 122.672,127.646 C125.152,128.153 127.414,129.421 129.14,131.273 C129.639,131.865 130.014,132.552 130.24,133.292 C131.472,136.567 131.802,140.112 131.195,143.557 C131.026,144.911 130.821,146.241 130.615,147.583 C130.423,148.557 130.844,149.549 131.679,150.086 C134.194,151.875 136.419,154.052 139.26,155.406 C144.459,157.824 147.953,162.068 150.867,166.844 C152.088,168.849 153.484,170.743 155.038,172.502 C157.021,171.511 158.738,170.459 159.488,168.21 C160.093,166.683 160.779,165.19 161.543,163.736 C161.894,162.963 162.184,162.165 162.534,161.318 L160.89,160 C155.874,156.322 153.499,150.032 154.833,143.956 C155.432,140.571 157.377,137.574 160.225,135.65 C161.084,135.033 161.966,134.441 163.006,133.752 C162.885,132.929 162.825,132.071 162.643,131.249 C160.434,121.333 159.524,111.173 159.935,101.022 C161.35,67.338 179.28,38.26 210.28,22.832 C220.099,17.999 230.598,14.693 241.414,13.027 C251.445,11.388 261.625,10.845 271.773,11.406 C287.757,12.362 302.846,16.424 316.63,24.779 C324.015,29.238 330.647,34.842 336.277,41.379 C337.314,42.637 338.587,43.68 340.025,44.45 C341.879,45.5 343.635,46.714 345.272,48.077 C347.618,49.927 349.903,51.874 352.152,53.845 C352.872,54.491 353.477,55.256 353.941,56.105 C356.09,60.005 357.782,64.139 358.983,68.426 C359.881,71.979 360.236,75.648 360.035,79.307 C360.035,81.036 359.89,82.765 359.793,84.797 C360.12,84.458 360.337,84.325 360.41,84.132 C361.893,80.045 363.053,75.849 363.88,71.582 C364.237,70.07 363.943,68.477 363.07,67.193 C362.055,65.775 361.184,64.261 360.47,62.671 C358.56,58.246 356.311,53.953 355.392,49.141 C354.316,43.471 354.014,37.824 355.815,32.214 C356.529,30.014 357.157,27.777 358.016,25.625 C359.527,21.841 362.344,19.048 365.355,16.412 C369.584,12.882 374.143,9.769 378.969,7.114 C381.324,5.787 383.498,4.161 385.437,2.278 C385.751,1.913 386.113,1.591 386.513,1.323 C386.899,1.059 387.37,0.951 387.831,1.021 C388.233,1.291 388.474,1.745 388.472,2.23 C388.387,6.268 389.681,10.04 390.769,13.837 C391.737,17.077 392.788,20.293 393.695,23.509 C394.372,26.445 394.372,29.496 393.695,32.432 C393.126,35.967 392.173,39.429 390.854,42.757 C389.959,44.91 389.125,47.074 388.327,49.25 C387.611,51.369 386.362,53.268 384.7,54.763 C384.151,55.271 383.638,55.817 383.164,56.396 C383.394,57.169 383.914,56.988 384.373,56.94 C385.244,56.819 386.114,56.734 386.961,56.553 C390.022,56.061 393.148,56.126 396.186,56.746 C398.019,56.991 399.767,57.666 401.288,58.717 C403.573,60.337 405.943,61.836 408.144,63.553 C409.306,64.57 410.338,65.727 411.215,66.999 C411.705,67.732 412.05,68.553 412.23,69.417 C412.447,70.075 412.351,70.796 411.969,71.373 C411.587,71.951 410.962,72.322 410.272,72.379 C409.802,72.498 409.316,72.539 408.833,72.5 C403.259,71.956 397.867,73.202 392.462,74.205 C389.04,74.858 385.667,75.692 382.258,76.43 C378.297,77.389 374.241,77.896 370.167,77.941 C369.356,77.987 368.549,78.079 367.749,78.219 C366.624,79.259 366.54,80.637 366.189,81.75 C365.838,82.862 365.512,83.974 365.21,85.087 C364.73,86.248 364.409,87.468 364.255,88.714 C365.113,88.714 365.319,88.049 365.681,87.638 C367.09,86.162 368.785,84.989 370.663,84.192 C371.626,83.722 372.708,83.549 373.77,83.696 C374.353,83.779 374.877,84.095 375.224,84.571 C375.57,85.047 375.708,85.643 375.608,86.223 C375.441,87.18 374.99,88.065 374.314,88.762 C372.737,90.611 370.789,92.106 368.595,93.151 C365.693,94.542 363.759,96.923 361.728,99.269 C361.31,99.797 361.077,100.446 361.063,101.119 C361.055,102.538 361.209,103.954 361.522,105.339 C362.139,104.94 362.55,104.722 362.913,104.444 C366.265,101.821 369.841,99.499 373.601,97.504 C378.884,94.796 384.41,93.308 390.395,94.312 C395.231,95.134 400.14,95.847 404.903,96.96 C407.793,97.748 410.606,98.796 413.306,100.091 C415.519,101.046 417.586,102.316 419.714,103.465 C419.968,103.598 420.295,103.767 420.367,103.996 C420.482,104.329 420.482,104.691 420.367,105.024 C420.283,105.254 419.944,105.387 419.702,105.556 C417.864,106.765 415.966,107.974 414.189,109.28 C408.337,113.609 402.34,117.647 395.424,120.162 C392.063,121.371 388.799,122.87 385.462,124.127 C380.543,125.9 375.46,127.176 370.288,127.936 C367.607,128.454 364.836,128.249 362.26,127.344 C361.657,127.174 361.043,127.049 360.422,126.969 C360.153,127.691 359.931,128.43 359.757,129.181 C356.906,144.638 350.982,159.365 342.334,172.49 C334.926,183.842 326.146,194.238 316.194,203.442 C308.127,210.966 299.542,217.916 290.502,224.238 C289.8,224.734 289.099,225.253 288.41,225.785 C288.277,225.894 288.241,226.112 288.096,226.414 C288.231,226.733 288.385,227.044 288.555,227.345 Q333.411,292.635 378.231,357.791 C379.295,357.658 379.295,356.86 379.525,356.292 C382.125,350.041 384.93,343.875 388.109,337.89 C393.287,327.926 399.6,318.595 406.922,310.081 C415.782,299.653 426.719,291.186 439.035,285.223 C447.036,281.287 455.638,278.717 464.486,277.618 C472.635,276.723 480.736,276.989 488.571,279.71 C500.081,283.7 507.831,291.401 510.793,303.359 C513.541,313.459 511.135,324.264 504.361,332.244 C499.249,338.942 491.787,343.453 483.48,344.866 C469.346,347.2 457.776,342.557 448.925,331.313 C445.973,327.317 444.194,322.577 443.787,317.626 C443.654,316.574 443.593,315.51 443.436,314.458 C443.247,311.732 441.114,309.543 438.394,309.283 C436.19,308.93 433.938,309.021 431.769,309.549 C428.287,310.395 424.95,311.752 421.866,313.576 C416.092,316.942 410.876,321.184 406.403,326.15 C398.657,334.684 392.458,344.504 388.085,355.167 C386.659,358.541 385.437,362.011 384.107,365.444 C384.567,366.218 384.917,366.895 385.316,367.512 Q411.529,404.763 437.766,442.002 C447.894,456.641 463.027,467.07 480.313,471.322 C492.585,474.478 504.494,473.063 516.077,468.348 C517.949,467.565 519.753,466.627 521.469,465.543 C529.309,460.857 534.792,453.067 536.558,444.106 C536.6,443.067 536.944,442.062 537.55,441.216 C540.224,441.048 542.907,441.073 545.578,441.289 C545.678,441.873 545.742,442.462 545.771,443.054 C545.6,453.433 543.394,463.678 539.279,473.208 C532.314,488.769 520.913,500.037 505.727,507.558 C494.776,513.022 482.697,515.846 470.459,515.804 C457.467,515.9 444.542,513.933 432.168,509.976 C425.624,507.874 419.363,504.979 413.524,501.355 C408.862,498.438 404.567,494.971 400.732,491.03 C400.26,490.534 399.777,490.063 399.281,489.591 C399.128,489.481 398.962,489.392 398.785,489.325 C395.742,489.828 392.821,490.903 390.177,492.493 C388.945,493.27 387.51,493.665 386.054,493.629 C384.99,493.629 383.926,493.629 382.862,493.629 C382.312,493.675 381.766,493.764 381.23,493.895 C381.454,494.277 381.717,494.633 382.016,494.959 C384.277,496.785 386.562,498.586 388.835,500.364 C389.971,501.271 391.12,502.153 392.232,503.084 C400.007,509.541 403.96,518.064 405.423,527.846 C405.871,530.893 405.895,534 406.076,537.095 C406.149,538.304 405.786,538.824 404.541,539.199 C403.436,539.555 402.304,539.818 401.155,539.985 C398.568,540.311 395.956,540.541 393.369,540.807 C392.16,540.928 390.854,540.988 389.609,541.145 C385.58,541.754 381.462,541.282 377.675,539.779 C372.532,537.791 367.609,535.275 362.985,532.271 C359.798,529.907 356.911,527.162 354.389,524.098 C352.423,521.969 350.628,519.689 349.02,517.279 C348.621,516.686 348.343,515.828 347.376,515.852 L347.376,515.392 L347.062,515.501 z M234.969,256.024 C233.76,256.737 232.878,257.233 231.995,257.826 Q216.193,267.849 200.402,277.872 C196.727,280.204 193.227,282.802 189.932,285.646 C181.15,293.27 173.55,302.157 167.383,312.016 C157.708,327.034 151.671,344.104 149.755,361.866 C148.106,377.608 150.122,393.519 155.643,408.354 C161.187,423.057 169.383,436.618 179.824,448.362 C186.4,456.005 194.24,462.463 203.002,467.453 C222.555,478.791 245.373,483.172 267.735,479.882 C286.467,477.405 304.06,469.484 318.334,457.103 C330.777,446.254 340.585,432.712 347.013,417.507 C347.158,417.156 347.267,416.781 347.449,416.298 z M333.423,168.972 L333.955,169.141 C334.439,168.452 334.947,167.775 335.394,167.061 C338.664,161.912 341.495,156.496 343.858,150.872 C351.151,133.765 353.392,114.926 350.314,96.585 C347.689,81.381 341.857,66.91 333.206,54.135 C328.638,47.278 322.758,41.393 315.904,36.821 C312.155,34.248 308.186,32.01 304.043,30.135 C289.788,23.751 275.026,21.538 259.598,24.779 C241.462,28.611 228.368,39.021 220.473,55.827 C216.781,63.843 214.628,72.48 214.125,81.29 C213.482,91.153 214.371,101.056 216.761,110.646 C220.226,124.763 226.295,138.11 234.655,150.001 Q242.623,161.403 250.615,172.816 Q265.51,194.096 280.406,215.351 C280.873,216.302 281.556,217.131 282.401,217.769 C282.701,217.683 282.992,217.569 283.271,217.431 C292.643,211.404 301.506,204.623 309.774,197.155 C310.101,196.84 310.56,196.562 310.367,195.813 C310.064,195.619 309.69,195.329 309.278,195.087 C303.835,191.754 298.628,188.049 293.694,184 C292.411,182.974 291.226,181.833 290.151,180.591 C287.068,177.133 284.033,173.614 281.011,170.096 C280.817,169.878 280.878,169.431 280.817,169.008 C282.461,168.609 283.985,168.307 285.46,167.871 C289.736,166.589 294.225,166.178 298.663,166.662 C299.872,166.807 301.166,166.795 302.423,166.916 C304.539,167.11 306.655,167.267 308.759,167.593 C311.539,168.031 314.189,169.076 316.521,170.652 C319.297,172.59 321.841,174.842 324.102,177.362 L326.06,179.539 C327.197,178.698 328.114,177.594 328.732,176.323 C328.009,174.311 326.796,172.512 325.202,171.087 C323.716,169.839 322.485,168.316 321.575,166.602 C321.215,165.921 320.97,165.186 320.849,164.426 C320.725,163.792 320.944,163.14 321.425,162.711 C321.907,162.281 322.58,162.138 323.195,162.334 C323.949,162.51 324.652,162.858 325.25,163.349 C326.314,164.317 327.233,165.441 328.2,166.505 C328.563,166.904 328.575,167.605 329.409,167.714 C329.53,165.199 329.337,162.733 329.24,160.254 C329.21,159.543 328.72,158.935 328.031,158.755 C327.586,158.565 327.13,158.404 326.665,158.271 C323.213,157.318 319.883,155.971 316.738,154.257 C313.546,152.637 310.355,151.029 307.066,149.53 C303.902,147.855 300.502,146.668 296.982,146.011 C296.793,145.986 296.607,145.941 296.426,145.878 C294.286,145.189 293.815,143.678 295.217,141.876 C296.167,140.645 297.416,149.675 298.844,139.059 C300.875,138.177 302.979,137.463 305.047,136.641 C307.05,135.901 309.208,135.676 311.322,135.988 C314.015,136.31 316.64,137.061 319.096,138.213 C319.543,138.419 320.063,138.951 320.728,138.213 C320.341,137.512 319.882,136.786 319.519,136.013 C319.025,135.184 318.654,134.288 318.419,133.353 C317.573,127.815 316.714,122.253 317.21,116.619 C317.289,114.088 317.942,111.607 319.12,109.365 C320.499,107.031 321.925,104.734 323.34,102.425 C325.291,99.543 326.799,96.384 327.813,93.054 C327.813,92.909 328.091,92.813 328.212,92.704 C328.333,92.595 328.66,92.631 328.781,92.704 C329.103,92.914 329.386,93.18 329.615,93.49 C330.449,94.699 331.162,95.908 332.106,97.044 C333.629,98.798 335.261,100.442 336.942,102.086 C339.641,104.851 342.07,107.867 344.196,111.094 C346.459,114.386 347.677,118.283 347.69,122.278 C347.69,122.955 347.69,123.632 347.69,124.309 C347.929,130.555 346.078,136.703 342.431,141.78 C340.28,145.23 337.673,148.374 334.681,151.126 C333.696,151.923 333.108,153.111 333.073,154.378 C333.073,155.345 332.879,156.313 332.891,157.268 C332.891,160.653 332.976,164.039 333.049,167.424 C333.242,168.016 333.339,168.476 333.387,168.947 z M126.347,233.245 L124.364,234.914 C123.881,234.757 123.433,234.6 122.986,234.479 C121.426,234.031 121.221,234.164 120.459,235.482 C118.463,239.13 116.932,243.013 115.901,247.041 C114.909,250.535 114.595,249.979 117.243,253.304 C119.044,255.452 120.245,258.038 120.725,260.8 C120.863,261.657 121.107,262.494 121.45,263.291 C122.78,266.507 124.159,269.699 125.549,272.878 C126.181,274.289 127.066,275.572 128.161,276.663 C129.156,277.709 130.065,278.833 130.881,280.024 C133.384,283.567 135.802,287.182 138.329,290.712 C139.397,292.082 140.215,293.629 140.747,295.282 C140.992,296.22 141.475,297.078 142.15,297.773 C143.903,299.563 145.607,301.4 147.361,303.19 C147.786,303.562 148.239,303.901 148.715,304.205 C150.915,302.222 152.971,300.336 155.087,298.499 C157.202,296.661 159.512,294.763 161.7,292.864 C163.889,290.966 166.186,289.564 168.036,287.605 C168.025,287.355 167.984,287.108 167.915,286.867 C166.307,284.11 165.086,281.144 164.288,278.053 C164.014,276.086 162.709,274.416 160.866,273.676 C159.876,273.227 159.118,272.386 158.774,271.355 C157.166,268.058 155.34,264.871 153.309,261.816 C152.862,261.193 152.526,260.498 152.318,259.76 C151.694,257.021 150.558,254.424 148.969,252.107 C148.053,250.737 147.382,249.22 146.986,247.621 C146.169,243.203 143.689,239.265 140.058,236.619 C139.381,236.111 138.849,235.325 137.906,235.337 C136.818,235.688 136.588,236.715 136.044,237.489 C135.681,238.009 135.222,238.469 134.835,238.964 C133.16,238.298 131.677,237.226 130.518,235.845 C129.473,234.519 127.998,233.6 126.347,233.245 z M229.371,248.613 C228.561,247.404 228.005,246.485 227.401,245.614 C222.794,239.049 218.139,232.52 213.617,225.894 C212.427,224.136 210.867,222.659 209.047,221.566 C207.447,220.667 205.911,219.657 204.453,218.543 C202.754,217.111 200.871,215.911 198.855,214.976 C197.174,214.227 195.493,213.501 193.849,212.691 C192.205,211.881 190.573,211.047 189.013,210.104 C187.394,209.043 185.595,208.285 183.705,207.867 C181.045,207.384 178.385,206.876 175.725,206.428 C174.395,206.211 173.041,206.041 171.699,205.957 C168.229,205.751 164.759,205.618 161.289,205.425 C159.747,205.211 158.176,205.403 156.731,205.981 C155.232,206.658 153.637,207.098 152.003,207.287 C150.083,207.556 148.251,208.264 146.647,209.354 C143.655,211.316 140.85,213.55 138.268,216.028 C136.783,217.696 134.904,218.968 132.804,219.728 C131.602,220.126 130.538,220.855 129.732,221.832 C128.149,224.069 127.234,226.711 127.097,229.449 C128.898,230.211 130.724,231.021 132.622,231.758 C133.424,232.161 134.383,232.086 135.113,231.565 C137.011,230.041 138.74,230.634 140.336,232 C141.545,233.052 142.827,234.128 144.072,235.204 C147.212,237.839 149.371,241.455 150.202,245.469 C150.302,245.797 150.427,246.116 150.577,246.424 C150.939,246.315 151.181,246.315 151.278,246.207 C152.964,244.209 154.274,241.924 155.147,239.46 C155.377,238.722 155.667,237.997 155.909,237.272 C156.84,234.483 158.792,232.15 161.374,230.743 C165.753,228.276 169.89,225.402 173.73,222.158 C174.974,221.068 176.457,220.285 178.059,219.873 C182.77,218.812 187.543,218.045 192.35,217.576 C193.803,217.46 195.263,217.696 196.606,218.265 C198.045,218.809 199.544,219.22 201.007,219.704 C201.829,219.982 202.651,220.272 203.425,220.586 C205.261,221.246 206.825,222.497 207.874,224.141 C208.32,224.766 208.822,225.348 209.374,225.882 C210.28,226.874 211.26,227.817 212.094,228.869 C214.452,231.879 215.721,235.204 214.838,239.097 C214.543,240.128 214.543,241.222 214.838,242.253 C215.827,245.496 216.136,248.908 215.745,252.276 C215.568,253.773 215.601,255.286 215.842,256.774 C216.341,256.569 216.829,256.339 217.305,256.085 C221.271,253.642 225.249,251.285 229.371,248.613 z M130.917,317.771 C130.071,316.852 129.346,316.078 128.656,315.292 C127.375,313.854 126.045,312.439 124.848,310.928 C119.535,304.026 114.967,296.581 111.222,288.717 C110.92,287.815 110.425,286.99 109.771,286.299 C107.462,286.214 105.454,286.142 103.447,286.045 C98.72,285.84 93.993,285.549 89.313,286.638 C86.917,286.964 84.588,287.666 82.41,288.717 C80.24,289.985 78.137,291.365 76.111,292.852 C74.336,294.202 72.262,295.106 70.065,295.488 C69.509,295.585 68.965,295.73 68.518,295.814 C67.103,299.575 65.942,305.221 66.099,307.663 C66.536,307.477 66.96,307.263 67.369,307.022 C68.601,306.159 70.253,306.208 71.431,307.143 C72.242,307.675 72.979,308.292 73.753,308.884 C74.887,309.874 76.243,310.575 77.706,310.928 C78.154,310.178 78.558,309.403 78.916,308.606 C79.37,307.536 80.075,306.591 80.971,305.85 C82.558,304.279 85.106,304.252 86.726,305.789 C87.406,306.477 88.021,307.225 88.564,308.026 C88.951,308.534 89.301,309.102 89.773,309.791 C90.105,309.537 90.452,309.303 90.813,309.09 C92.3,308.28 93.062,308.304 94.138,309.513 C95.005,310.422 95.715,311.468 96.241,312.608 C97.094,314.651 97.836,316.737 98.466,318.859 C98.912,320.679 99.96,322.294 101.44,323.442 C101.44,322.982 101.573,322.644 101.585,322.293 C101.585,320.564 101.585,318.823 101.743,317.082 C101.68,316.296 102.005,315.529 102.613,315.026 C104.681,313.648 106.833,312.717 109.42,313.467 C110.818,313.829 112.235,314.111 113.664,314.313 C114.63,314.456 115.524,314.905 116.215,315.595 C116.712,316.053 117.158,316.564 117.545,317.118 C118.118,318.044 119.172,318.557 120.253,318.436 C123.542,318.363 126.831,318.327 130.107,318.255 C130.24,318.255 130.397,318.061 130.917,317.771 z M109.964,250.136 C109.88,250.136 109.735,250.196 109.722,250.245 C108.723,254.089 108.367,258.073 108.671,262.033 C109.07,266.168 109.783,270.267 110.448,274.366 C111.485,280.391 113.594,286.181 116.675,291.462 C119.008,295.573 121.608,299.55 124.098,303.552 C127.035,308.225 130.59,312.479 134.665,316.199 C135.049,316.538 135.453,316.853 135.875,317.142 C139.355,313.964 142.566,310.502 145.475,306.793 L142.464,303.456 L141.485,303.685 C139.647,304.157 139.066,303.831 138.547,302.029 C138.305,301.098 138.16,300.131 138.002,299.176 C137.623,296.783 136.646,294.525 135.161,292.61 C132.562,289.612 130.352,286.297 128.584,282.744 C128.314,282.231 128.007,281.738 127.665,281.269 C127.072,280.248 126.098,279.504 124.957,279.202 C122.732,278.742 121.982,277.255 121.946,275.212 C121.87,273.758 121.456,272.343 120.737,271.077 C118.924,267.873 117.65,264.393 116.965,260.776 C116.848,260.111 116.597,259.478 116.227,258.914 C114.317,256.012 112.358,253.134 110.387,250.269 C110.4,250.16 110.146,250.184 109.964,250.136 z M175.254,175.041 C174.335,174.509 174.045,174.219 173.718,174.171 C172.294,173.931 170.857,173.782 169.414,173.723 C167.758,173.813 166.104,173.524 164.578,172.877 C163.981,172.557 163.307,172.41 162.631,172.454 C160.724,172.84 158.991,173.827 157.686,175.271 C156.578,176.382 156.024,177.929 156.175,179.49 C156.175,180.361 156.332,181.219 156.344,182.09 C156.373,182.667 156.316,183.246 156.175,183.807 C156.008,184.377 155.537,184.807 154.953,184.919 C154.369,185.031 153.772,184.807 153.406,184.339 C152.983,183.699 152.673,182.991 152.487,182.247 C152.233,181.425 152.173,180.542 151.943,179.708 C151.508,178.148 150.964,177.907 149.38,178.499 C147.887,178.982 146.606,179.964 145.753,181.28 C143.925,184.134 141.679,186.698 139.091,188.885 C138.582,189.331 138.106,189.812 137.664,190.324 C135.576,192.499 134.165,195.233 133.602,198.195 C133.384,199.441 133.023,200.658 132.525,201.822 C131.406,204.821 130.928,208.021 131.123,211.216 C131.232,212.367 131.484,213.5 131.873,214.59 C132.099,215.032 132.388,215.439 132.731,215.799 C133.456,215.182 134.073,214.735 134.617,214.203 C137.855,211.154 141.373,208.418 145.124,206.029 C147.228,204.466 149.712,203.494 152.318,203.212 C153.172,203.05 154.016,202.836 154.845,202.571 C156.163,202.318 157.505,202.148 158.835,201.943 L160.552,201.713 C160.736,201.247 160.893,200.771 161.023,200.286 C161.736,196.986 162.353,193.661 163.151,190.372 C163.627,188.504 164.262,186.679 165.049,184.919 C165.494,184.068 166.107,183.315 166.851,182.707 C167.552,182.054 168.435,181.618 169.172,180.978 C169.793,180.526 170.301,179.939 170.659,179.261 C171.395,177.165 173.135,175.579 175.29,175.041 z M108.55,357.96 C109.49,356.571 110.299,355.098 110.968,353.559 C111.5,352.726 111.5,351.66 110.968,350.827 C109.988,349.062 109.118,347.2 108.151,345.446 C106.405,342.541 105.178,339.354 104.524,336.028 C104.333,334.885 104.046,333.761 103.665,332.667 C103.433,332.045 103.089,331.471 102.649,330.974 C100.848,328.834 99.022,326.742 97.185,324.614 C96.059,323.273 95.304,321.659 94.996,319.935 C94.847,318.982 94.616,318.044 94.307,317.13 C94.031,315.835 93.313,314.676 92.276,313.854 C91.889,314.603 91.562,315.28 91.212,315.933 C90.861,316.586 90.946,317.493 90.003,317.747 C89.057,317.254 88.376,316.369 88.141,315.329 C87.887,314.603 87.778,313.817 87.5,313.104 C87.055,311.898 86.521,310.726 85.904,309.598 C85.454,308.704 84.471,308.212 83.486,308.389 C82.604,308.559 81.903,309.231 81.696,310.106 C81.455,310.831 81.37,311.617 81.104,312.342 C80.354,314.434 78.928,315.341 76.86,314.543 C74.952,313.854 73.162,312.876 71.552,311.641 C70.887,311.121 70.343,310.359 69.255,310.432 C68.977,310.734 68.639,311.073 68.336,311.436 C68.034,311.798 67.659,312.354 67.284,312.85 C68.545,316.002 70.203,318.98 72.217,321.713 C74.865,325.025 77.356,328.471 80.306,331.542 C81.515,332.751 82.615,334.13 83.933,335.254 C85.849,336.878 87.555,338.734 89.011,340.779 C90.184,342.308 91.465,343.75 92.844,345.096 C93.298,345.488 93.788,345.836 94.307,346.136 C94.403,345.612 94.544,345.099 94.73,344.6 C94.931,343.985 95.444,343.523 96.077,343.388 C96.711,343.253 97.368,343.467 97.801,343.947 C98.014,344.142 98.212,344.352 98.394,344.576 C101.056,347.507 103.41,350.703 105.418,354.115 C106.196,355.593 107.26,356.9 108.55,357.96 z M181.094,258.273 C180.491,260.306 179.085,262.005 177.2,262.976 C176.124,263.617 175.06,264.294 174.02,265.007 C172.848,265.726 171.986,266.855 171.602,268.175 C171.037,270.532 169.904,272.716 168.302,274.535 C167.832,275.042 167.639,275.745 167.782,276.421 C168.199,279.096 168.984,281.7 170.115,284.159 C170.433,284.604 170.802,285.01 171.215,285.368 C171.832,284.945 172.316,284.631 172.775,284.292 Q182.061,277.57 191.903,271.73 C194.901,269.965 197.791,268.03 200.801,266.289 C202.003,265.644 202.822,264.461 203.002,263.109 C203.363,261.297 203.247,259.422 202.663,257.668 C202.039,256.029 202.017,254.22 202.603,22.566 C202.681,252.168 202.718,251.763 202.712,251.357 C202.087,251.091 201.434,250.896 200.765,250.777 C199.704,250.735 198.641,250.771 197.585,250.886 C194.865,251.103 192.362,252.228 189.787,253.014 C188.301,253.449 186.905,254.145 185.664,255.069 C184.237,256.169 182.689,257.161 181.106,258.249 z M164.65,202.39 C165.545,202.499 166.113,202.608 166.681,202.62 C170.738,202.696 174.781,203.101 178.772,203.829 C179.63,203.981 180.501,204.05 181.372,204.034 C184.683,204.043 187.919,205.031 190.669,206.876 C192.314,207.879 194.055,208.726 195.784,209.572 C198.045,210.684 200.342,211.7 202.603,212.8 C203.522,213.247 204.38,213.792 205.287,214.299 C205.384,214.082 205.468,213.973 205.444,213.925 C198.19,202.257 189.4,191.642 182.472,179.781 C182.327,179.539 182.158,179.297 182.073,179.164 C181.811,179.193 181.555,179.258 181.311,179.357 C180.182,180.369 178.486,180.41 177.309,179.454 C176.719,179.208 176.096,179.053 175.459,178.995 C174.879,179.877 174.444,180.639 173.912,181.304 C173.326,182.19 172.594,182.971 171.747,183.613 C169.789,184.822 168.858,186.672 167.77,188.45 C167.168,189.34 166.906,190.417 167.032,191.484 C167.149,192.539 166.911,193.603 166.355,194.507 C165.228,196.973 164.651,199.655 164.662,202.366 z M175.532,259.663 C175.552,259.325 175.552,258.986 175.532,258.648 C175.254,256.592 175.532,256.085 177.394,255.395 C177.938,255.19 178.506,255.057 179.062,254.9 C180.286,254.574 181.375,253.867 182.17,252.881 C184.173,250.651 185.898,248.187 187.308,245.542 C188.058,243.978 189.164,242.612 190.536,241.552 C193.595,239.049 196.582,236.425 199.544,233.838 C199.757,233.643 199.955,233.433 200.136,233.209 C200.644,232.629 201.116,232 201.66,231.468 C202.271,230.85 202.938,230.291 203.655,229.8 C204.436,229.371 205.244,228.991 206.073,228.663 C204.878,228.396 203.64,228.396 202.446,228.663 C198.006,229.6 193.636,230.836 189.364,232.363 C186.553,233.413 183.943,234.938 181.65,236.873 C178.325,239.666 175.024,242.483 171.614,245.167 C166.362,249.145 162.066,254.246 159.04,260.099 C158.702,260.788 158.411,261.489 158.061,262.251 C159.27,264.306 160.479,266.265 161.483,268.296 C162.245,270.027 163.809,271.274 165.666,271.633 C167.01,270.675 167.856,269.168 167.975,267.522 C168.347,264.877 170.036,262.6 172.461,261.477 C173.537,260.957 174.565,260.256 175.556,259.639 z M355.066,483.34 C353.687,479.979 352.648,476.993 349.214,475.771 C348.764,475.592 348.334,475.365 347.932,475.094 C345.865,473.885 345.393,472.978 345.913,470.524 C346.228,468.916 346.14,467.254 345.659,465.688 C345.259,464.397 344.948,463.08 344.728,461.746 C344.467,460.226 344.386,458.679 344.486,457.14 C344.743,454.052 345.511,451.028 346.759,448.193 C349.012,442.961 351.547,437.855 354.352,432.898 C355.294,431.319 356.037,429.63 356.565,427.868 C356.142,427.191 355.743,426.526 355.295,425.898 C355.029,425.511 354.763,425.075 354.086,425.378 C353.893,425.922 353.639,426.587 353.421,427.179 C350.715,435.141 347.014,442.729 342.407,449.764 C338.461,455.845 334.012,461.584 329.107,466.921 C328.466,467.622 327.608,468.13 327.451,469.339 C327.838,470.343 328.224,471.431 328.66,472.495 C329.675,474.913 330.715,477.331 331.743,479.689 C332.127,481.128 333.367,482.175 334.85,482.312 C335.522,482.408 336.175,482.608 336.785,482.905 C338.971,483.71 341.331,483.927 343.628,483.534 C345.633,483.284 347.652,483.155 349.673,483.147 C351.293,483.05 352.926,483.207 355.09,483.292 z M359.309,432.294 C359.054,432.464 358.819,432.663 358.608,432.886 C357.382,434.404 356.682,436.28 356.613,438.23 C356.613,440.539 356.613,442.861 356.613,445.182 C356.613,450.091 357.266,455 356.807,459.933 C356.475,464.012 357.314,468.101 359.225,471.721 C359.895,473.002 360.684,474.216 361.583,475.348 C362.419,476.693 363.918,477.48 365.5,477.404 C366.782,477.333 368.025,477.854 368.873,478.818 C369.289,479.221 369.734,479.592 370.203,479.931 C374.906,483.655 380.311,484.489 386.078,483.655 C386.648,483.532 387.203,483.35 387.735,483.11 C389.161,482.542 390.588,481.901 392.003,481.357 C392.148,481.357 392.208,481.067 392.389,480.765 L391.18,478.927 C388.45,479.769 385.537,479.823 382.777,479.084 C376.285,477.464 371.037,474.248 368.269,467.743 C367.144,465.083 365.996,462.423 364.847,459.776 C364.508,458.978 364.061,458.216 363.759,457.357 C362.834,455.233 362.07,453.043 361.474,450.804 C360.509,446.559 360.103,442.206 360.265,437.855 C360.265,436.888 360.422,435.933 360.506,434.966 C360.71,433.904 360.245,432.826 359.334,432.245 z M104.511,437.033 C103.668,437.041 102.826,437.122 101.997,437.275 C98.829,438.121 95.673,439.028 92.53,439.947 C91.89,440.16 91.274,440.44 90.692,440.781 C90.353,440.95 89.93,441.18 89.809,441.482 C88.975,443.683 87.161,445.472 87.391,448.144 C87.524,450.403 86.61,452.597 84.913,454.093 C83.823,455.313 82.53,456.336 81.092,457.116 C80.584,457.345 79.726,457.599 80.125,458.639 C82.422,458.772 84.731,458.845 87.04,459.062 C88.379,459.186 89.704,458.718 90.668,457.781 C95.957,453.275 100.873,448.351 105.37,443.054 C105.781,442.534 106.119,441.954 106.579,441.325 C105.878,439.935 105.72,438.363 104.511,437.033 z M394.844,484.344 C393.446,485.242 391.954,485.984 390.395,486.556 C383.539,488.213 376.793,488.176 370.457,484.489 C369.538,483.957 368.68,483.28 367.821,482.711 C367.243,482.184 366.455,481.948 365.681,482.071 C364.423,482.242 363.152,481.868 362.187,481.043 C359.673,479.214 357.633,476.809 356.238,474.03 C353.596,469.365 352.531,463.971 353.204,458.651 C353.591,454.685 353.034,450.744 353.034,446.778 C352.926,446.325 352.747,445.893 352.502,445.496 C352.128,445.859 351.862,446.016 351.729,446.258 C351.326,446.915 350.974,447.602 350.677,448.314 C350.024,450.127 349.468,451.941 348.815,453.803 C347.751,456.939 347.751,460.339 348.815,463.475 C349.679,465.945 349.969,468.579 349.661,471.177 C349.661,471.346 349.782,471.54 349.903,471.866 C350.251,472.124 350.628,472.339 351.027,472.507 C353.233,473.318 355.042,474.946 356.081,477.053 C357.182,479.084 358.113,481.212 359.019,483.34 C359.252,484.075 359.79,484.674 360.494,484.985 C364.799,486.713 369.067,488.503 373.383,490.208 C374.098,490.467 374.865,490.554 375.62,490.462 C378.864,489.975 382.149,489.813 385.425,489.978 C386.494,490.109 387.572,489.824 388.436,489.18 C389.716,488.306 391.128,487.645 392.619,487.221 C393.8,486.995 394.917,486.517 395.896,485.819 z"/>
        </g>
    </svg>
            </div> 
        </div>
    </div>


<script>
    (() => { // IIFE to encapsulate the entire script and avoid global scope pollution.

        // --- 1. APPLICATION STATE & CONSTANTS --- 

        /** @type {tinymce.Editor | null} The active TinyMCE editor instance. */
        let editor = null;
        /** @type {Array<Object>} Holds the state for all open tabs (chapters). */
        let tabs = [];
        /** @type {number | null} The ID of the currently active tab. */
        let activeTabId = null;
		let projectTitle = 'be a good duck.'; 
		let clickTimer = null;

        /** @type {boolean} A flag to prevent concurrent state-changing operations (like switching tabs while another is closing). */
        let isStateOperationInProgress = false;
        /** @type {TurndownService | null} Instance of Turndown to convert HTML to Markdown. */
        let turndownService = null;
        /** @type {boolean} Toggles typewriter sound effects on/off. */
        let soundsEnabled = true;
        /** @type {boolean} Toggles between the primary (serif) and secondary (sans-serif) font. */
        let isPrimaryFont = true;

        // Constants 
        const FONT_PRIMARY = '"Georgia", serif';
        const FONT_SECONDARY = 'system-ui, -apple-system, sans-serif';

        // DOM Element References 
        const tabListEl = document.getElementById('tab-list');

// Check if the browser supports service workers
if ('serviceWorker' in navigator) {
  // Register the service worker
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/DuckWriter/sw.js')
      .then((reg) => {
        console.log('Service Worker: Registered successfully');
      })
      .catch((err) => {
        console.log('Service Worker: Registration failed: ', err);
      });
  });
}

	    
        // --- 2. CORE LOGIC (Data & State Management) --- 
		
        /** * Creates a new tab object, adds it to the application state, and makes it active. 
         * @param {string} [name='Untitled'] The name for the new tab. 
         * @param {string} [content=''] The initial content of the new tab. 
         * @returns {Promise<Object | null>} The new tab object or null if an operation was in progress. 
         */
        async function createNewTab(name = `Untitled ${tabs.length + 1}`, content = '') {
            if (isStateOperationInProgress) return null;
            isStateOperationInProgress = true;
            let newTab = null;
            try {
                await saveCurrentTabContent();
                newTab = { id: Date.now(), name, content};
                tabs.push(newTab);
                activeTabId = newTab.id;

                if (editor && editor.initialized) {
                    await loadTabContent(newTab);
                    renderTabs();
                    saveStateToLocalStorage();
                }
            } finally {
                isStateOperationInProgress = false;
            }
            return newTab;
        }


        /** * Switches the active tab. Saves the current tab's content before switching. 
         * @param {number} tabId The ID of the tab to switch to. 
         */
        async function switchTab(tabId) {
            if (tabId === activeTabId || isStateOperationInProgress) return;
            isStateOperationInProgress = true;
            try {
                await saveCurrentTabContent();
                activeTabId = tabId;
                const tabToLoad = tabs.find(t => t.id === activeTabId);
                await loadTabContent(tabToLoad);
                renderTabs();
                saveStateToLocalStorage();
            } finally {
                isStateOperationInProgress = false;
            }
        }

        /** * Closes a tab, removing it from the state and the UI. 
         * @param {number} tabId The ID of the tab to close. 
         */
        async function closeTab(tabId) {
            if (!confirm('Are you sure you want to close this chapter?')) {
                return; // Stop if the user cancels. 
            }

            if (isStateOperationInProgress) return;
            isStateOperationInProgress = true;
            try {
                const index = tabs.findIndex(t => t.id === tabId);
                if (index === -1) return;

                tabs.splice(index, 1);

                // If the closed tab was active, switch to an adjacent tab or create a new one. 
                if (activeTabId === tabId) {
                    const newActiveTab = tabs[index] || tabs[index - 1] || null;
                    if (newActiveTab) {
                        activeTabId = newActiveTab.id;
                        await loadTabContent(newActiveTab);
                    } else {
                        await createNewTab(); // Create a new tab if it was the last one 
                    }
                }
                
                renderTabs();
                saveStateToLocalStorage();
                updateStats();
            } finally {
                isStateOperationInProgress = false;
            }
        }

        /** * Moves the active tab up or down in the list. 
         * @param {number} direction -1 to move up, 1 to move down. 
         */
        function moveActiveTab(direction) {
            if (!activeTabId) return;
            const index = tabs.findIndex(t => t.id === activeTabId);
            if (index === -1) return;

            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= tabs.length) return; // Boundary check 

            // Swap elements in the array 
            [tabs[index], tabs[newIndex]] = [tabs[newIndex], tabs[index]];
            
            renderTabs();
            saveStateToLocalStorage();
        }

        /** * Saves the current editor content to the active tab's state object. 
         */
        async function saveCurrentTabContent() {
            if (activeTabId === null || !editor || !editor.initialized) return;
            const currentTab = tabs.find(t => t.id === activeTabId);
            if (currentTab) {
                currentTab.content = getContentAsMarkdown();
            }
        }

        /** * Saves the entire application state (tabs, active tab) to localStorage. 
         */
        function saveStateToLocalStorage() {
            try {
                const serializableTabs = tabs.map(tab => ({
                    id: tab.id,
                    name: tab.name,
                    content: tab.content
                }));
                const state = { tabs: serializableTabs, activeTabId, projectTitle };
                localStorage.setItem('editorState', JSON.stringify(state));
            } catch (e) {
                console.error("Could not save state. Storage may be full.", e);
            }
        }

        /** * Loads application state from localStorage on startup. 
         * @returns {Promise<boolean>} True if state was successfully loaded, otherwise false. 
         */
		async function loadState() {
			soundsEnabled = (localStorage.getItem('soundsEnabled') || 'true') === 'true';
			isPrimaryFont = (localStorage.getItem('isPrimaryFont') || 'true') === 'true';

			const savedStateJSON = localStorage.getItem('editorState');
			if (!savedStateJSON) return false;

			try {
				const savedState = JSON.parse(savedStateJSON);
				if (!savedState || typeof savedState !== 'object') return false;

				projectTitle = savedState.projectTitle || 'Chapters';
				document.getElementById('chapters-title').textContent = projectTitle;

				tabs = Array.isArray(savedState.tabs) ? savedState.tabs : [];
				activeTabId = savedState.activeTabId || null;
				return true;
			} catch (e) {
				console.error("Failed to load or parse state from localStorage. Starting fresh.", e);
				localStorage.removeItem('editorState');
				return false;
			}
		}

        // --- 3. UI, EVENT HANDLING & EDITOR INTEGRATION --- 

		/** * Renders the tab list in the sidebar based on the current `tabs` array. 
		 */
		function renderTabs() {
			tabListEl.innerHTML = ''; // Clear existing tabs 

			tabs.forEach(tab => {
				// --- Create the main tab container ---
				const tabEl = document.createElement('div');
				tabEl.className = 'tab';
				tabEl.dataset.tabId = tab.id;
				if (tab.id === activeTabId) {
					tabEl.classList.add('active');
				}

				// --- Create and add the close button FIRST ---
				const closeSpan = document.createElement('span');
				closeSpan.className = 'tab-close';
				closeSpan.innerHTML = '&times;';
				tabEl.appendChild(closeSpan);

				// --- Create the chapter name span ---
				const displayName = tab.name.replace(/\.[^/.]+$/, ""); // Hide file extension for display
				const nameSpan = document.createElement('span');
				nameSpan.className = 'tab-name';
				nameSpan.textContent = displayName;
				nameSpan.setAttribute('contenteditable', 'false');
				nameSpan.dataset.originalName = displayName;
				
				tabEl.appendChild(nameSpan);

			

				// --- Add the completed tab to the list ---
				tabListEl.appendChild(tabEl);
			});

			updateReorderButtonsState();
		}

        /** * Applies the user's chosen font to the UI and editor. 
         */
        function applyFontSetting() {
            const targetFont = isPrimaryFont ? FONT_PRIMARY : FONT_SECONDARY;
            
            document.body.style.fontFamily = targetFont;
            if (editor && editor.initialized) {
                editor.getDoc().body.style.fontFamily = targetFont;
            }

            const fontButton = document.getElementById('toggle-font-btn');
            if (fontButton) {
                fontButton.classList.toggle('active-command', isPrimaryFont);
            }
        }
		
        /** * Updates the word and character count display for the current chapter and the total project. 
         */
        function updateStats() {
            if (!editor || !editor.initialized) return;
            const markdownContent = getContentAsMarkdown();
            
            const words = markdownContent ? (markdownContent.match(/\b\w+\b/g)?.length ?? 0) : 0;
            const chars = markdownContent.length;

            let totalWords = 0, totalChars = 0;
            tabs.forEach(tab => {
                const tabText = tab.content || '';
                totalWords += tabText ? (tabText.match(/\b\w+\b/g)?.length ?? 0) : 0;
                totalChars += tabText.length;
            });

            document.getElementById('stats-display').innerHTML = `${words} / ${totalWords} `;
        }
        
        /** * Updates the active state of formatting buttons (Bold, Italic, etc.) based on the cursor's position. 
         */
        function updateToolbarActiveStates() {
            if (!editor || !editor.initialized) return;
            const commandMap = {
                'custom-bold-btn': 'bold',
                'custom-italic-btn': 'italic',
                'custom-h1-btn': 'h1',
                'custom-h2-btn': 'h2',
                'custom-h3-btn': 'h3'
            };
            for (const buttonId in commandMap) {
                const button = document.getElementById(buttonId);
                if (button) {
                    const command = commandMap[buttonId];
                    const isActive = command.startsWith('h') ? editor.formatter.match(command) : editor.queryCommandState(command);
                    button.classList.toggle('active-command', !!isActive);
                }
            }
        }
        
        /** * Enables or disables the up/down chapter reorder buttons based on the active tab's position. 
         */
        function updateReorderButtonsState() {
            const moveUpBtn = document.getElementById('move-up-btn');
            const moveDownBtn = document.getElementById('move-down-btn');
            if (!moveUpBtn || !moveDownBtn) return;
            
            const index = tabs.findIndex(t => t.id === activeTabId);
            moveUpBtn.disabled = (index <= 0);
            moveDownBtn.disabled = (index === -1 || index >= tabs.length - 1);
        }


        
        /** * Sets the editor's content from a Markdown string, parsing it to HTML first. 
         * @param {string} content - The Markdown content to load. 
         */
        function setContent(content) {
            if (editor && editor.initialized) {
                editor.setContent(marked.parse(content || ''));
            }
        }

        /** * Loads the content for a given tab into the editor. 
         * @param {Object} tab The tab object whose content should be loaded. 
         */
        async function loadTabContent(tab) {
            const content = tab ? tab.content : '';
            if (editor && editor.initialized) {
                setContent(content);
                editor.undoManager.clear();
                updateStats();
                updateToolbarActiveStates();
            }
        }
        
        /** * Gets the current editor content as Markdown. 
         * @returns {string} The editor content converted from HTML to Markdown. 
         */
        function getContentAsMarkdown() {
            if (!editor || !editor.initialized) return '';
            return turndownService.turndown(editor.getContent());
        }

        /** * Plays an audio element if sounds are enabled. 
         * @param {HTMLAudioElement} audioElement The audio element to play. 
         */
        function playSound(audioElement) {
            if (!soundsEnabled || !audioElement) return;
            audioElement.currentTime = 0;
            audioElement.play().catch(error => {
                if (error.name !== 'AbortError') {
                    console.error("Audio playback error:", error);
                }
            });
        }
        
        /** * Applies user preferences (colors, fonts, sounds) from localStorage to the UI. 
         */
        function applyStoredPreferences() {
            const textColorPicker = document.getElementById('editor-text-color');
            const bgColorPicker = document.getElementById('editor-bg-color');
            const editorBody = tinymce.get('editor').getDoc().body;
            
            const savedTextColor = localStorage.getItem('editorTextColor') || '#d4d4d4';
            const savedBgColor = localStorage.getItem('editorBgColor') || '#2d2d2d';

            textColorPicker.value = savedTextColor;
            bgColorPicker.value = savedBgColor;
            editorBody.style.color = savedTextColor;
            editorBody.style.backgroundColor = savedBgColor;

            document.getElementById('toggle-sounds-btn').classList.toggle('active-command', soundsEnabled);
            applyFontSetting();
        }

        /**
         * Sets up a toggle button to show/hide a container and manage its active state.
         * @param {string} buttonId The ID of the toggle button.
         * @param {string} containerId The ID of the container to toggle.
         */
		function setupToggleButton(buttonId, containerId) {
			const button = document.getElementById(buttonId);
			const container = document.getElementById(containerId);

			if (!button || !container) {
				console.warn(`Toggle button setup failed for button: #${buttonId}`);
				return;
			}

			button.addEventListener('click', () => {
				const isNowVisible = container.classList.toggle('visible');
				button.classList.toggle('active-command', isNowVisible);
			});
		}

        /** * Attaches all primary event listeners for the application UI. 
         */
        function setupEventListeners() {
            editor.on('input', debounce(async () => {
                await saveCurrentTabContent();
                saveStateToLocalStorage();
                updateStats();
      
            }, 500));

            editor.on('NodeChange', debounce(updateToolbarActiveStates, 100));

            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    handleQuickSave();
                }
            });

            tabListEl.addEventListener('click', (e) => {
				clearTimeout(clickTimer);
				clickTimer = setTimeout(() => {
					const tabEl = e.target.closest('.tab');
					if (!tabEl) return;
					
					const tabId = Number(tabEl.dataset.tabId);
					if (e.target.closest('.tab-close')) {
						closeTab(tabId);
					} else if (!e.target.closest('.tab-name[contenteditable="true"]')) {
						switchTab(tabId);
					}
				}, 200);
            });

            tabListEl.addEventListener('dblclick', (e) => {
				clearTimeout(clickTimer);
                const nameSpan = e.target.closest('.tab-name');
                if (nameSpan) {
                    nameSpan.setAttribute('contenteditable', 'true');
                    nameSpan.focus();
                    document.execCommand('selectAll', false, null);
                }
            });

            tabListEl.addEventListener('blur', (e) => {
                const nameSpan = e.target.closest('.tab-name');
                if (nameSpan && nameSpan.getAttribute('contenteditable') === 'true') {
                    nameSpan.setAttribute('contenteditable', 'false');
                    const newName = nameSpan.textContent.trim();
                    const tabId = Number(nameSpan.closest('.tab').dataset.tabId);
                    const tab = tabs.find(t => t.id === tabId);
                    
                    if (tab && newName) {
                        tab.name = newName;
                        saveStateToLocalStorage();
                        renderTabs();
                    } else {
                        nameSpan.textContent = nameSpan.dataset.originalName;
                    }
                }
            }, true);

			const chaptersTitleEl = document.getElementById('chapters-title');

			chaptersTitleEl.addEventListener('dblclick', () => {
				chaptersTitleEl.setAttribute('contenteditable', 'true');
				chaptersTitleEl.focus();
				document.execCommand('selectAll', false, null);
			});

			chaptersTitleEl.addEventListener('blur', () => {
				chaptersTitleEl.setAttribute('contenteditable', 'false');
				const newTitle = chaptersTitleEl.textContent.trim();
				if (newTitle) {
					projectTitle = newTitle;
					saveStateToLocalStorage();
				} else {
					chaptersTitleEl.textContent = projectTitle;
				}
			});

			chaptersTitleEl.addEventListener('keydown', (e) => {
				if (chaptersTitleEl.getAttribute('contenteditable') === 'true' && e.key === 'Enter') {
					e.preventDefault();
					chaptersTitleEl.blur();
				}
			});

            tabListEl.addEventListener('keydown', (e) => {
                const nameSpan = e.target.closest('.tab-name');
                if (nameSpan && nameSpan.getAttribute('contenteditable') === 'true') {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        nameSpan.blur();
                    } else if (e.key === 'Escape') {
                        nameSpan.textContent = nameSpan.dataset.originalName;
                        nameSpan.blur();
                    }
                }
            });
            
            document.getElementById('new-tab-btn').addEventListener('click', () => createNewTab());
            document.getElementById('move-up-btn').addEventListener('click', () => moveActiveTab(-1));
            document.getElementById('move-down-btn').addEventListener('click', () => moveActiveTab(1));
            document.getElementById('custom-import-btn').addEventListener('click', handleImportProject);
            document.getElementById('custom-open-btn').addEventListener('click', handleFileOpen);
            document.getElementById('custom-save-as-btn').addEventListener('click', handleSaveAs);
            document.getElementById('custom-save-all-btn').addEventListener('click', handleSaveAll);
            document.getElementById('duck-export-btn').addEventListener('click', handleExportProject);
            document.getElementById('custom-export-all-btn').addEventListener('click', handleExportProject);
            document.getElementById('custom-print-btn').addEventListener('click', handlePrint);
            document.getElementById('custom-print-all-btn').addEventListener('click', handlePrintAll);
            document.getElementById('toggle-fullscreen-btn').addEventListener('click', toggleFullScreen);

            document.getElementById('custom-undo-btn').addEventListener('click', () => editor.execCommand('undo'));
            document.getElementById('custom-redo-btn').addEventListener('click', () => editor.execCommand('redo'));
            document.getElementById('custom-bold-btn').addEventListener('click', () => editor.execCommand('bold'));
            document.getElementById('custom-italic-btn').addEventListener('click', () => editor.execCommand('italic'));
            document.getElementById('custom-h1-btn').addEventListener('click', () => editor.execCommand('mceToggleFormat', false, 'h1'));
            document.getElementById('custom-h2-btn').addEventListener('click', () => editor.execCommand('mceToggleFormat', false, 'h2'));
            document.getElementById('custom-h3-btn').addEventListener('click', () => editor.execCommand('mceToggleFormat', false, 'h3'));
            
            setupToggleButton('toggle-file-btn', 'file-controls-container');
            setupToggleButton('toggle-colors-btn', 'color-picker-container');
            setupToggleButton('toggle-settings-btn', 'settings-container');
            setupToggleButton('toggle-export-btn', 'export-container');
            
            document.getElementById('editor-text-color').addEventListener('input', (e) => {
                const newColor = e.target.value;
                tinymce.get('editor').getDoc().body.style.color = newColor;
                localStorage.setItem('editorTextColor', newColor);
            });
            document.getElementById('editor-bg-color').addEventListener('input', (e) => {
                const newColor = e.target.value;
                tinymce.get('editor').getDoc().body.style.backgroundColor = newColor;
                localStorage.setItem('editorBgColor', newColor);
            });
            document.getElementById('toggle-sounds-btn').addEventListener('click', (e) => {
                soundsEnabled = !soundsEnabled;
                e.currentTarget.classList.toggle('active-command', soundsEnabled);
                localStorage.setItem('soundsEnabled', String(soundsEnabled));
            });
            document.getElementById('toggle-font-btn').addEventListener('click', () => {
                isPrimaryFont = !isPrimaryFont;
                localStorage.setItem('isPrimaryFont', String(isPrimaryFont));
                applyFontSetting();
            });
            
        }
        
        // --- 4. FILE SYSTEM, PRINTING & FULLSCREEN HANDLERS --- 

        /** * Handles opening a single text file and creating a new tab for it. 
         */
        async function handleFileOpen() {
			try {
				const [fileHandle] = await window.showOpenFilePicker({
					types: [{ description: 'Text File', accept: { 'text/plain': ['.txt', '.md'] } }]
				});
				const file = await fileHandle.getFile();
				const content = await file.text();
				await createNewTab(file.name, content);
			} catch (err) {
				if (err.name !== 'AbortError') console.error("File open error:", err);
			}
        }

        /** * Saves the current tab's content. Now an alias for handleSaveAs.
         */
        async function handleQuickSave() {
            await handleSaveAs();
        }
        
        /** * Triggers the "Save As" dialog for the currently active tab. 
         */
        async function handleSaveAs() {
            await saveTabAs(activeTabId);
        }

        /** * Saves a specific tab to a new file location chosen by the user. 
         * @param {number} tabId The ID of the tab to save. 
         * @returns {Promise<boolean>} True on successful save, false on failure or cancellation. 
         */
        async function saveTabAs(tabId) {
            const tab = tabs.find(t => t.id === tabId);
            if (!tab) return false;
            try {
                const handle = await window.showSaveFilePicker({
                    suggestedName: tab.name.replace(/\.[^/.]+$/, '') + '.txt',
                    types: [{ description: 'Text File', accept: { 'text/plain': ['.txt', '.md'] } }],
                });
                
                const writable = await handle.createWritable();
				const contentToSave = (tab.id === activeTabId) ? getContentAsMarkdown() : tab.content;
                await writable.write(contentToSave);
                await writable.close();

                tab.name = handle.name;
               
                
                if (activeTabId === tabId) renderTabs();
				saveStateToLocalStorage();
                return true;
            } catch (err) {
                if (err.name !== 'AbortError') console.error(`Could not save tab ${tab.id}:`, err);
                return false;
            }
        }
        
        /** * Iterates through all tabs and triggers "Save As" for each one.
         */
        async function handleSaveAll() {
            await saveCurrentTabContent();
            for (const tab of tabs) {
                await saveTabAs(tab.id);
            }
            renderTabs();
            alert("Save All complete.");
        }
        
		/**
		 * Gathers all chapters and exports them as a single text file.
		 * The file format for each chapter is: `#### Chapter Name\n\n---\n\nChapter Content`
		 */
// Replace your existing handleExportProject function with this
async function handleExportProject() {
    await saveCurrentTabContent();
    const suggestedFilename = `${generateProjectIdentifier()}.txt`; // Use the helper

    const fullText = tabs.map(tab => {
        const cleanName = tab.name.replace(/\.[^/.]+$/, "");
        return `#### ${cleanName}\n\n---\n\n${tab.content}`;
    }).join('\n\n\n');

    try {
        const handle = await window.showSaveFilePicker({
            suggestedName: suggestedFilename, // Use the generated filename
            types: [{
                description: 'Text File',
                accept: { 'text/plain': ['.txt', '.md'] }
            }],
        });

        const writable = await handle.createWritable();
        await writable.write(fullText);
        await writable.close();
    } catch (err) {
        if (err.name !== 'AbortError') {
            console.error("Project export error:", err);
        }
    }
}
		/**
		 * Imports a project file, parsing it into separate chapters and creating new tabs.
		 */
		async function handleImportProject() {
			if (!confirm('Importing a project will replace all current tabs. Are you sure?')) {
				return;
			}

			try {
				const [fileHandle] = await window.showOpenFilePicker({
					types: [{ description: 'Text File', accept: { 'text/plain': ['.txt', '.md'] } }],
				});
				const file = await fileHandle.getFile();
				const fullText = await file.text();

				tabs = [];
				activeTabId = null;

				const chapterBlocks = fullText.trim().split(/\n\n\n#### /);
				
				if (chapterBlocks.length > 0 && chapterBlocks[0].startsWith('#### ')) {
					chapterBlocks[0] = chapterBlocks[0].substring(5);
				}

				chapterBlocks.forEach((block, index) => {
					const parts = block.split('\n\n---\n\n');
					if (parts.length >= 1) {
						const tabName = parts.shift().trim();
						const tabContent = parts.join('\n\n---\n\n').trim();

						tabs.push({
							id: Date.now() + index,
							name: tabName,
							content: tabContent
						});
					}
				});

				if (tabs.length > 0) {
					activeTabId = tabs[0].id;
					await loadTabContent(tabs[0]);
				} else {
					await createNewTab();
				}

				renderTabs();
				saveStateToLocalStorage();
				alert(`Project imported successfully with ${tabs.length} chapter(s)!`);

			} catch (err) {
				if (err.name !== 'AbortError') {
					console.error('Failed to import project:', err);
					alert('An error occurred during import. The file might be corrupted or in the wrong format.');
				}
			}
		}


        /** * Triggers the browser's print dialog for the current chapter's content. 
         */
        /**
 * Triggers the browser's print dialog for the current chapter's content,
 * using the chapter's name as the document title.
 */
function handlePrint() {
    const currentTab = tabs.find(t => t.id === activeTabId);
    // Use the tab's clean name as the title, with a fallback
    const printTitle = currentTab ? currentTab.name.replace(/\.[^/.]+$/, "") : "Current Chapter";

    printContent(editor.getContent(), printTitle);
}

        /** * Triggers the browser's print dialog for all chapters combined. 
         */
 // Replace your existing handlePrintAll function with this
async function handlePrintAll() {
    await saveCurrentTabContent();
    const printTitle = generateProjectIdentifier(); // Generate the title

    let fullHtml = tabs.map(tab => {
        const cleanName = tab.name.replace(/\.[^/.]+$/, "");
        return `<h3>${escapeHtml(cleanName)}</h3>${marked.parse(tab.content || '')}`;
    }).join('<hr>');

    printContent(fullHtml, printTitle); // Pass the title to be printed
}

        /** * Creates a temporary, hidden iframe to print HTML content without altering the main page. 
         * @param {string} htmlContent The HTML content string to be printed. 
         */
function printContent(htmlContent, documentTitle = 'Print') {
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    document.body.appendChild(iframe);
    
    const iframeDoc = iframe.contentWindow.document;
    iframeDoc.open();
    // We've added a <style> block to the <head> to control the print margins
    iframeDoc.write(`
        <html>
            <head>
                <title>${escapeHtml(documentTitle)}</title>
                <style>
                    @page {
                        margin: 0.75in; /* Adjust this value for your desired print margin */
                    }
                    body {
                        margin: 0;
                        font-family: ${isPrimaryFont ? FONT_PRIMARY : FONT_SECONDARY}; 
                        line-height: 1.8;
                    }
                </style>
            </head>
            <body>
                ${htmlContent}
            </body>
        </html>
    `);
    iframeDoc.close();
    
    iframe.contentWindow.focus();
    iframe.contentWindow.print();
    document.body.removeChild(iframe);
}
        
        /** * Toggles the browser's fullscreen mode. 
         */
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }


        // --- 5. UTILITIES & INITIALIZATION --- 

/**
 * Generates a filename-safe string from the project title and current date.
 * @returns {string} The formatted string, e.g., "2025-08-02_My_Project_Title".
 */
function generateProjectIdentifier() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0'); // JS months are 0-11
    const day = String(now.getDate()).padStart(2, '0');
    const dateString = `${year}-${month}-${day}`;

    // Sanitize the project title to make it a valid filename
    const sanitizedTitle = projectTitle.replace(/\s+/g, '_').replace(/[^\w-]/g, '');

    return `${dateString}_${sanitizedTitle}`;
}



        /** * Escapes basic HTML characters to prevent them from being interpreted as tags. 
         * @param {string} unsafe The string to escape. 
         * @returns {string} The escaped string. 
         */
        function escapeHtml(unsafe) {
			return unsafe
				.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;");
		}

        /** * Creates a debounced function that delays invoking `func` until after `timeout` milliseconds 
         * have elapsed since the last time the debounced function was invoked. 
         * @param {Function} func The function to debounce. 
         * @param {number} [timeout=300] The number of milliseconds to delay. 
         * @returns {Function} The new debounced function. 
         */
        function debounce(func, timeout = 300) {
            let timer;
            return (...args) => {
                clearTimeout(timer);
                timer = setTimeout(() => { func.apply(this, args); }, timeout);
            };
        }

        /** * The callback function executed once the TinyMCE editor is fully initialized. 
         * This is where the main application logic kicks in after loading is complete. 
         */
        async function onEditorReady() {
            const stateLoaded = await loadState();

            if (stateLoaded && tabs.length > 0) {
                const activeTabExists = tabs.some(t => t.id === activeTabId);
                if (!activeTabExists) {
                    activeTabId = tabs[0].id;
                }
            } else if (tabs.length === 0) {
                await createNewTab();
            }

            const initialTab = tabs.find(t => t.id === activeTabId);
            await loadTabContent(initialTab);
            
            renderTabs();
            applyStoredPreferences();
            setupEventListeners();
        }

        /** * Configures and initializes the TinyMCE editor. 
         */
        function setupEditor() {
            tinymce.init({
                selector: '#editor',
                promotion: false,
                toolbar: false,
                menubar: false,
                statusbar: false,
                skin: 'oxide-dark',
                content_css: 'dark',
                plugins: 'autoresize',
                autoresize_min_height: 500,
                autoresize_bottom_margin: 50,
content_style: ` 
    body.mce-content-body { 
        background: #2d2d2d; 
        color: #d4d4d4; 
        padding: 1rem 2rem !important; /* Adjust padding here */
        line-height: 1.6;
        font-size: 1.2em;
		letter-spacing: 0.5px;
    }

    /* This rule is still needed to let text fill the space */
    p, h1, h2, h3, h4, h5, h6 {
        max-width: 100% !important;
    }
`,             setup: (ed) => {
                    editor = ed;
                    editor.on('init', onEditorReady);
					
					// --- ADD THIS BLOCK TO MANAGE HOTKEYS ---
// TinyMCE automatically handles mapping 'ctrl' to 'Cmd' on macOS.

// Save Chapter (Ctrl+S)
editor.shortcuts.add('ctrl+s', 'Save Chapter', () => {
    handleQuickSave();
});

// Quacksave All / Export Project (Ctrl+Q)
editor.shortcuts.add('ctrl+q', 'Quacksave All (Export Project)', () => {
    handleExportProject();
});

// Open / Import Project (Ctrl+O)
editor.shortcuts.add('ctrl+o', 'Open (Import Project)', () => {
    handleImportProject();
});

// Print Chapter (Ctrl+P)
editor.shortcuts.add('ctrl+p', 'Print Chapter', () => {
    handlePrint();
});

// Print All Chapters (Ctrl+Shift+P)
editor.shortcuts.add('ctrl+shift+p', 'Print All Chapters', () => {
    handlePrintAll();
});
// --- END OF HOTKEY BLOCK ---

                    const keySounds = ['key-sound-1', 'key-sound-2', 'key-sound-3', 'key-sound-4'].map(id => document.getElementById(id));
                    const returnSound = document.getElementById('return-sound');
                    const spaceSound = document.getElementById('space-sound');
                    
                    editor.on('keydown', (event) => {
					 // --- NEW: Handle exiting fullscreen with the Escape key ---
    if (event.key === 'Escape' && document.fullscreenElement) {
        event.preventDefault(); // Stop TinyMCE from doing anything else
        document.exitFullscreen();
        return; // We are done with this key press
    }
					
					
                        if (event.key === 'Enter') {
                            playSound(returnSound);
                            setTimeout(() => { editor.selection.getNode().scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 50);
                        } else if (event.key === ' ') {
                            playSound(spaceSound);
                        } else if (event.key.length === 1 || event.key === 'Backspace' || event.key === 'Delete') {
                            const soundToPlay = keySounds[Math.floor(Math.random() * keySounds.length)];
                            playSound(soundToPlay);
                        }
                    });
                }
            });
        }

        /** * The main entry point for the application. 
         */
        async function initializeApp() {
            if (typeof tinymce === 'undefined' || typeof TurndownService === 'undefined' || typeof marked === 'undefined') {
                return alert('Fatal Error: A required library did not load. Please check your internet connection and refresh.');
            }
            
            turndownService = new TurndownService({ headingStyle: 'atx', codeBlockStyle: 'fenced' });
            setupEditor();
        }

        // --- KICK IT OFF --- 
        document.addEventListener('DOMContentLoaded', initializeApp);

    })();
</script>
</body>

</html> 










